
// Trumbowyg - A lightweight WYSIWYG editor
// Includded Plugins: history, font family, font colors
// github.com/Alex-D/Trumbowyg
// (c) 2012-2019 Alexandre Demode
// License: MIT

// contains changes and fixes by unixman
// (c) 2019 unix-world.org

/**
 * trumbowyg.js v2.20.0
 * Trumbowyg - Editor Core
 */

jQuery.trumbowyg = {
	langs: {
		en: {
			viewHTML: 'View HTML',

			undo: 'Undo',
			redo: 'Redo',

			formatting: 'Formatting',
			p: 'Paragraph',
			blockquote: 'Quote',
			code: 'Code',
			header: 'Header',

			bold: 'Bold',
			italic: 'Italic',
			strikethrough: 'Strikethrough',
			underline: 'Underline',

			strong: 'Strong',
			em: 'Emphasis',
			//-- fix by unixman
		//	del: 'Deleted',
			s: 'Strike',
			//--

			superscript: 'Superscript',
			subscript: 'Subscript',

			unorderedList: 'Unordered list',
			orderedList: 'Ordered list',

			insertImage: 'Insert Image',
			link: 'Link',
			createLink: 'Insert link',
			unlink: 'Remove link',

			justifyLeft: 'Align Left',
			justifyCenter: 'Align Center',
			justifyRight: 'Align Right',
			justifyFull: 'Align Justify',

			horizontalRule: 'Insert horizontal rule',
			removeformat: 'Remove format',

			fullscreen: 'Fullscreen',

			close: 'Close',

			submit: 'Confirm',
			reset: 'Cancel',

			required: 'Required',
			description: 'Description',
			title: 'Title',
			text: 'Text',
			target: 'Target',
			width: 'Width'
		}
	},

	// Plugins
	plugins: {},

	hideButtonTexts: null
};

// Makes default options read-only
Object.defineProperty(jQuery.trumbowyg, 'defaultOptions', {
	value: {
		lang: 'en',

		fixedBtnPane: false,
		fixedFullWidth: false,
		autogrow: false,
		autogrowOnEnter: false,
		imageWidthModalEdit: false,

		prefix: 'trumbowyg-',

		semantic: true,
		semanticKeepAttributes: false,
		resetCss: false,
		removeformatPasted: false,
		tabToIndent: false,
		tagsToRemove: [],
		tagsToKeep: ['hr', 'img', 'embed', 'iframe', 'input'],
		btns: [
			['viewHTML'],
			['undo', 'redo'], // Only supported in Blink browsers
			['formatting'],
			//-- fix by unixman
		//	['strong', 'em', 'del'],
			['strong', 'em', 's'],
			//-- #fix
			['superscript', 'subscript'],
			['link'],
			['insertImage'],
			['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull'],
			['unorderedList', 'orderedList'],
			['horizontalRule'],
			['removeformat'],
			['fullscreen']
		],
		// For custom button definitions
		btnsDef: {},
		changeActiveDropdownIcon: false,

		inlineElementsSelector: 'a,abbr,acronym,b,caption,cite,code,col,dfn,dir,dt,dd,em,font,hr,i,kbd,li,q,span,s,strong,sub,sup,u', // fix by unixman: replace 'strikeout' with 's'

		pasteHandlers: [],

		// imgDblClickHandler: default is defined in constructor

		plugins: {},
		urlProtocol: false,
		minimalLinks: false,
		defaultLinkTarget: undefined
	},
	writable: false,
	enumerable: true,
	configurable: false
});

(function (navigator, window, document, $) {
	'use strict';

	var CONFIRM_EVENT = 'tbwconfirm',
		CANCEL_EVENT = 'tbwcancel';

	$.fn.trumbowyg = function (options, params) {
		var trumbowygDataName = 'trumbowyg';
		if (options === Object(options) || !options) {
			return this.each(function () {
				if (!$(this).data(trumbowygDataName)) {
					$(this).data(trumbowygDataName, new Trumbowyg(this, options));
				}
			});
		}
		if (this.length === 1) {
			try {
				var t = $(this).data(trumbowygDataName);
				switch (options) {
					// Exec command
					case 'execCmd':
						return t.execCmd(params.cmd, params.param, params.forceCss, params.skipTrumbowyg);

					// Modal box
					case 'openModal':
						return t.openModal(params.title, params.content);
					case 'closeModal':
						return t.closeModal();
					case 'openModalInsert':
						return t.openModalInsert(params.title, params.fields, params.callback);

					// Range
					case 'saveRange':
						return t.saveRange();
					case 'getRange':
						return t.range;
					case 'getRangeText':
						return t.getRangeText();
					case 'restoreRange':
						return t.restoreRange();

					// Enable/disable
					case 'enable':
						return t.setDisabled(false);
					case 'disable':
						return t.setDisabled(true);

					// Toggle
					case 'toggle':
						return t.toggle();

					// Destroy
					case 'destroy':
						return t.destroy();

					// Empty
					case 'empty':
						return t.empty();

					// HTML
					case 'html':
						return t.html(params);
				}
			} catch (c) {
			}
		}

		return false;
	};

	// @param: editorElem is the DOM element
	var Trumbowyg = function (editorElem, options) {
		var t = this,
			trumbowygIconsId = 'trumbowyg-icons',
			$trumbowyg = $.trumbowyg;

		// Get the document of the element. It use to makes the plugin
		// compatible on iframes.
		t.doc = editorElem.ownerDocument || document;

		// jQuery object of the editor
		t.$ta = $(editorElem); // $ta : Textarea
		t.$c = $(editorElem); // $c : creator

		options = options || {};

		// Localization management
		if (options.lang != null || $trumbowyg.langs[options.lang] != null) {
			t.lang = $.extend(true, {}, $trumbowyg.langs.en, $trumbowyg.langs[options.lang]);
		} else {
			t.lang = $trumbowyg.langs.en;
		}

		t.hideButtonTexts = $trumbowyg.hideButtonTexts != null ? $trumbowyg.hideButtonTexts : options.hideButtonTexts;

		// SVG icons (fixed by unixman)
		t.hasSvg = !!$('#' + trumbowygIconsId).attr('id');
		if(!t.hasSvg) {
			$('body').prepend('<div style="display:none; visibility:hidden; width:1px; height:1px; position:fixed; left:-1px; top:-1px;" id="' + trumbowygIconsId + '" data-id="icons.svg">' + '<svg xmlns="http://www.w3.org/2000/svg"><symbol id="trumbowyg-blockquote" viewBox="0 0 72 72"><path d="M21.3 31.9h-.6c.8-1.2 1.9-2.2 3.4-3.2 2.1-1.4 5-2.7 9.2-3.3l-1.4-8.9c-4.7.7-8.5 2.1-11.7 4-2.4 1.4-4.3 3.1-5.8 4.9-2.3 2.7-3.7 5.7-4.5 8.5-.8 2.8-1 5.4-1 7.5 0 2.3.3 4 .4 4.8 0 .1.1.3.1.4 1.2 5.4 6.1 9.5 11.9 9.5 6.7 0 12.2-5.4 12.2-12.2s-5.5-12-12.2-12zM49.5 31.9h-.6c.8-1.2 1.9-2.2 3.4-3.2 2.1-1.4 5-2.7 9.2-3.3l-1.4-8.9c-4.7.7-8.5 2.1-11.7 4-2.4 1.4-4.3 3.1-5.8 4.9-2.3 2.7-3.7 5.7-4.5 8.5-.8 2.8-1 5.4-1 7.5 0 2.3.3 4 .4 4.8 0 .1.1.3.1.4 1.2 5.4 6.1 9.5 11.9 9.5 6.7 0 12.2-5.4 12.2-12.2s-5.5-12-12.2-12z" /></symbol><symbol id="trumbowyg-bold" viewBox="0 0 72 72"><path d="M51.1 37.8c-1.1-1.4-2.5-2.5-4.2-3.3 1.2-.8 2.1-1.8 2.8-3 1-1.6 1.5-3.5 1.5-5.3 0-2-.6-4-1.7-5.8-1.1-1.8-2.8-3.2-4.8-4.1-2-.9-4.6-1.3-7.8-1.3h-16v42h16.3c2.6 0 4.8-.2 6.7-.7 1.9-.5 3.4-1.2 4.7-2.1 1.3-1 2.4-2.4 3.2-4.1.9-1.7 1.3-3.6 1.3-5.7.2-2.5-.5-4.7-2-6.6zM40.8 50.2c-.6.1-1.8.2-3.4.2h-9V38.5h8.3c2.5 0 4.4.2 5.6.6 1.2.4 2 1 2.7 2 .6.9 1 2 1 3.3 0 1.1-.2 2.1-.7 2.9-.5.9-1 1.5-1.7 1.9-.8.4-1.7.8-2.8 1zm2.6-20.4c-.5.7-1.3 1.3-2.5 1.6-.8.3-2.5.4-4.8.4h-7.7V21.6h7.1c1.4 0 2.6 0 3.6.1s1.7.2 2.2.4c1 .3 1.7.8 2.2 1.7.5.9.8 1.8.8 3-.1 1.3-.4 2.2-.9 3z" /></symbol><symbol id="trumbowyg-close" viewBox="0 0 72 72"><path d="M57 20.5l-5.4-5.4-15.5 15.5-15.6-15.5-5.4 5.4L30.7 36 15.1 51.5l5.4 5.4 15.6-15.5 15.5 15.5 5.4-5.4L41.5 36z" /></symbol><symbol id="trumbowyg-create-link" viewBox="0 0 72 72"><path d="M31.1 48.9l-6.7 6.7c-.8.8-1.6.9-2.1.9s-1.4-.1-2.1-.9L15 50.4c-1.1-1.1-1.1-3.1 0-4.2l6.1-6.1.2-.2 6.5-6.5c-1.2-.6-2.5-.9-3.8-.9-2.3 0-4.6.9-6.3 2.6L11 41.8c-3.5 3.5-3.5 9.2 0 12.7l5.2 5.2c1.7 1.7 4 2.6 6.3 2.6s4.6-.9 6.3-2.6l6.7-6.7c2.5-2.6 3.1-6.7 1.5-10l-5.9 5.9zM38.7 22.5l6.7-6.7c.8-.8 1.6-.9 2.1-.9s1.4.1 2.1.9l5.2 5.2c1.1 1.1 1.1 3.1 0 4.2l-6.1 6.1-.2.2L42 38c1.2.6 2.5.9 3.8.9 2.3 0 4.6-.9 6.3-2.6l6.7-6.7c3.5-3.5 3.5-9.2 0-12.7l-5.2-5.2c-1.7-1.7-4-2.6-6.3-2.6s-4.6.9-6.3 2.6l-6.7 6.7c-2.7 2.7-3.3 6.9-1.7 10.2l6.1-6.1c0 .1 0 .1 0 0z" /><path d="M44.2 30.5c.2-.2.4-.6.4-.9 0-.3-.1-.6-.4-.9l-2.3-2.3c-.3-.2-.6-.4-.9-.4-.3 0-.6.1-.9.4L25.9 40.6c-.2.2-.4.6-.4.9 0 .3.1.6.4.9l2.3 2.3c.2.2.6.4.9.4.3 0 .6-.1.9-.4l14.2-14.2zM49.9 55.4h-8.5v-5h8.5v-8.9h5.2v8.9h8.5v5h-8.5v8.9h-5.2v-8.9z" /></symbol><symbol id="trumbowyg-s" viewBox="0 0 72 72"><path d="M45.8 45c0 1-.3 1.9-.9 2.8-.6.9-1.6 1.6-3 2.1s-3.1.8-5 .8c-2.1 0-4-.4-5.7-1.1-1.7-.7-2.9-1.7-3.6-2.7-.8-1.1-1.3-2.6-1.5-4.5l-.1-.8-6.7.6v.9c.1 2.8.9 5.4 2.3 7.6 1.5 2.3 3.5 4 6.1 5.1 2.6 1.1 5.7 1.6 9.4 1.6 2.9 0 5.6-.5 8-1.6 2.4-1.1 4.3-2.7 5.6-4.7 1.3-2 2-4.2 2-6.5 0-1.6-.3-3.1-.9-4.5l-.2-.6H44c0 .1 1.8 2.3 1.8 5.5zM29 28.9c-.8-.8-1.2-1.7-1.2-2.9 0-.7.1-1.3.4-1.9.3-.6.7-1.1 1.4-1.6.6-.5 1.4-.9 2.5-1.1 1.1-.3 2.4-.4 3.9-.4 2.9 0 5 .6 6.3 1.7 1.3 1.1 2.1 2.7 2.4 5.1l.1.9 6.8-.5v-.9c-.1-2.5-.8-4.7-2.1-6.7s-3.2-3.5-5.6-4.5c-2.4-1-5.1-1.5-8.1-1.5-2.8 0-5.3.5-7.6 1.4-2.3 1-4.2 2.4-5.4 4.3-1.2 1.9-1.9 3.9-1.9 6.1 0 1.7.4 3.4 1.2 4.9l.3.5h11.8c-2.3-.9-3.9-1.7-5.2-2.9zm13.3-6.2zM22.7 20.3zM13 34.1h46.1v3.4H13z" /></symbol><symbol id="trumbowyg-em" viewBox="0 0 72 72"><path d="M26 57l10.1-42h7.2L33.2 57H26z" /></symbol><symbol id="trumbowyg-fullscreen" viewBox="0 0 72 72"><path d="M25.2 7.1H7.1v17.7l6.7-6.5 10.5 10.5 4.5-4.5-10.4-10.5zm22 0l6.5 6.7-10.5 10.5 4.5 4.5 10.5-10.4 6.7 6.8V7.1zm.5 36.1l-4.5 4.5 10.4 10.5-6.8 6.7h18.1V47.2l-6.7 6.5zm-23.4 0L13.8 53.6l-6.7-6.8v18.1h17.7l-6.5-6.7 10.5-10.5z" /><path fill="currentColor" d="M10.7 28.8h18.1V11.2l-6.6 6.4L11.6 7.1l-4.5 4.5 10.5 10.5zm50.1 0l-6.4-6.6 10.5-10.6-4.5-4.5-10.5 10.5-6.7-6.9v18.1zm-.4 36.1l4.5-4.5-10.5-10.5 6.9-6.7H43.2v17.6l6.6-6.4zm-48.8 0l10.5-10.5 6.7 6.9V43.2H11.1l6.5 6.6L7.1 60.4z" /></symbol><symbol id="trumbowyg-h1" viewBox="0 0 72 72"><path d="M6.4 14.9h7.4v16.7h19.1V14.9h7.4V57h-7.4V38H13.8v19H6.4V14.9zM47.8 22.5c1.4 0 2.8-.1 4.1-.4 1.3-.2 2.5-.6 3.6-1.2 1.1-.5 2-1.3 2.8-2.1.8-.9 1.3-1.9 1.5-3.2h5.5v41.2h-7.4v-29H47.8v-5.3z" /></symbol><symbol id="trumbowyg-h2" viewBox="0 0 72 72"><path d="M1.5 14.9h7.4v16.7H28V14.9h7.4V57H28V38H8.8v19H1.5V14.9zM70.2 56.9H42c0-3.4.9-6.4 2.5-9s3.8-4.8 6.6-6.7c1.3-1 2.7-1.9 4.2-2.9 1.5-.9 2.8-1.9 4-3 1.2-1.1 2.2-2.2 3-3.4.8-1.2 1.2-2.7 1.2-4.3 0-.7-.1-1.5-.3-2.4s-.5-1.6-1-2.4c-.5-.7-1.2-1.3-2.1-1.8-.9-.5-2.1-.7-3.5-.7-1.3 0-2.4.3-3.3.8s-1.6 1.3-2.1 2.2-.9 2-1.2 3.3c-.3 1.3-.4 2.6-.4 4.1h-6.7c0-2.3.3-4.4.9-6.3.6-1.9 1.5-3.6 2.7-5 1.2-1.4 2.7-2.5 4.4-3.3 1.7-.8 3.8-1.2 6.1-1.2 2.5 0 4.6.4 6.3 1.2 1.7.8 3.1 1.9 4.1 3.1 1 1.3 1.8 2.6 2.2 4.1.4 1.5.6 2.9.6 4.2 0 1.6-.3 3.1-.8 4.5-.5 1.3-1.2 2.6-2.1 3.7-.9 1.1-1.8 2.2-2.9 3.1-1.1.9-2.2 1.8-3.4 2.7-1.2.8-2.4 1.6-3.5 2.4-1.2.7-2.3 1.5-3.3 2.2-1 .7-1.9 1.5-2.6 2.3-.7.8-1.3 1.7-1.5 2.6h20.1v5.9z" /></symbol><symbol id="trumbowyg-h3" viewBox="0 0 72 72"><path d="M1.4 14.5h7.4v16.7h19.1V14.5h7.4v42.1h-7.4v-19H8.8v19H1.4V14.5zM53.1 32.4c1.1 0 2.2 0 3.3-.2 1.1-.2 2.1-.5 2.9-1 .9-.5 1.6-1.2 2.1-2 .5-.9.8-1.9.8-3.2 0-1.8-.6-3.2-1.8-4.2-1.2-1.1-2.7-1.6-4.6-1.6-1.2 0-2.2.2-3.1.7-.9.5-1.6 1.1-2.2 1.9-.6.8-1 1.7-1.3 2.7-.3 1-.4 2-.4 3.1h-6.7c.1-2 .5-3.9 1.1-5.6.7-1.7 1.6-3.2 2.7-4.4s2.6-2.2 4.2-2.9c1.6-.7 3.5-1.1 5.6-1.1 1.6 0 3.2.2 4.7.7 1.6.5 2.9 1.2 4.2 2.1 1.2.9 2.2 2.1 3 3.4.7 1.4 1.1 3 1.1 4.8 0 2.1-.5 3.9-1.4 5.4-.9 1.6-2.4 2.7-4.4 3.4v.1c2.4.5 4.2 1.6 5.5 3.5 1.3 1.9 2 4.1 2 6.8 0 2-.4 3.7-1.2 5.3-.8 1.6-1.8 2.9-3.2 3.9-1.3 1.1-2.9 1.9-4.7 2.5-1.8.6-3.6.9-5.6.9-2.4 0-4.5-.3-6.3-1s-3.3-1.7-4.5-2.9c-1.2-1.3-2.1-2.8-2.7-4.5-.6-1.8-1-3.7-1-5.9h6.7c-.1 2.5.5 4.6 1.9 6.3 1.3 1.7 3.3 2.5 5.9 2.5 2.2 0 4.1-.6 5.6-1.9 1.5-1.3 2.3-3.1 2.3-5.4 0-1.6-.3-2.9-.9-3.8-.6-.9-1.5-1.7-2.5-2.2-1-.5-2.2-.8-3.4-.9-1.3-.1-2.6-.2-3.9-.1v-5.2z" /></symbol><symbol id="trumbowyg-h4" viewBox="0 0 72 72"><path d="M1.5 14.9h7.4v16.7H28V14.9h7.4V57H28V38H8.9v19H1.5V14.9zM70.5 47.2h-5.3V57h-6.4v-9.8H41.2v-6.7l17.7-24.8h6.4v26.2h5.3v5.3zm-24.2-5.3h12.5V23.7h-.1L46.3 41.9z" /></symbol><symbol id="trumbowyg-h5" viewBox="0 0 72 72"><path d="M1.5 14.9h7.4v16.7H28V14.9h7.4V57H28V38H8.9v19H1.5V14.9zM69.043 42.368q0 5.655-3.92 10.154-3.856 4.434-9.383 4.434-6.105 0-9.768-2.892-3.599-2.891-3.728-8.033h6.62q0 2.892 1.735 4.37 1.735 1.478 4.691 1.478 3.085 0 5.142-2.57 2.056-2.57 2.056-6.748 0-8.869-6.426-8.869-4.692 0-7.327 5.463h-5.848l.9-24.292h22.75v5.398H50.02l-.643 12.21q3.02-3.599 8.355-3.599 5.205 0 8.226 3.985 3.084 3.92 3.084 9.511z" /></symbol><symbol id="trumbowyg-h6" viewBox="0 0 72 72"><path d="M1.5 14.9h7.4v16.7H28V14.9h7.4V57H28V38H8.9v19H1.5zM69.188 43.56q0 2.269-.63 4.475-.63 2.206-2.017 4.286t-4.097 3.403q-2.71 1.261-6.366 1.261-4.349 0-7.185-1.324-2.773-1.386-4.16-4.16-1.386-2.836-1.89-6.113t-.505-8.194q0-22.312 14.181-22.312 10.4 0 11.66 10.526h-6.177q-.378-5.61-5.483-5.61-2.521 0-4.223 1.766-1.702 1.701-2.458 4.538-.693 2.836-1.008 5.168-.252 2.269-.252 4.664 1.575-2.458 3.53-3.719 2.016-1.323 5.42-1.323 3.34 0 5.735 1.26 2.458 1.198 3.656 3.215 1.197 2.017 1.701 4.033.568 2.017.568 4.16zm-6.492.252q0-8.193-6.555-8.193-6.68 0-6.68 8.193 0 8.257 6.68 8.257 6.555 0 6.555-8.257z" /></symbol><symbol id="trumbowyg-horizontal-rule" viewBox="0 0 72 72"><path d="M9.1 32h54v8h-54z" /></symbol><symbol id="trumbowyg-insert-image" viewBox="0 0 72 72"><path d="M64 17v38H8V17h56m8-8H0v54h72V9z" /><path d="M17.5 22C15 22 13 24 13 26.5s2 4.5 4.5 4.5 4.5-2 4.5-4.5-2-4.5-4.5-4.5zM16 50h27L29.5 32zM36 36.2l8.9-8.5L60.2 50H45.9S35.6 35.9 36 36.2z" /></symbol><symbol id="trumbowyg-italic" viewBox="0 0 72 72"><path d="M26 57l10.1-42h7.2L33.2 57H26z" /></symbol><symbol id="trumbowyg-justify-center" viewBox="0 0 72 72"><path d="M9 14h54v8H9zM9 50h54v8H9zM18 32h36v8H18z" /></symbol><symbol id="trumbowyg-justify-full" viewBox="0 0 72 72"><path d="M9 14h54v8H9zM9 50h54v8H9zM9 32h54v8H9z" /></symbol><symbol id="trumbowyg-justify-left" viewBox="0 0 72 72"><path d="M9 14h54v8H9zM9 50h54v8H9zM9 32h36v8H9z" /></symbol><symbol id="trumbowyg-justify-right" viewBox="0 0 72 72"><path d="M9 14h54v8H9zM9 50h54v8H9zM27 32h36v8H27z" /></symbol><symbol id="trumbowyg-link" viewBox="0 0 72 72"><path d="M30.9 49.1l-6.7 6.7c-.8.8-1.6.9-2.1.9s-1.4-.1-2.1-.9l-5.2-5.2c-1.1-1.1-1.1-3.1 0-4.2l6.1-6.1.2-.2 6.5-6.5c-1.2-.6-2.5-.9-3.8-.9-2.3 0-4.6.9-6.3 2.6L10.8 42c-3.5 3.5-3.5 9.2 0 12.7l5.2 5.2c1.7 1.7 4 2.6 6.3 2.6s4.6-.9 6.3-2.6l6.7-6.7C38 50.5 38.6 46.3 37 43l-6.1 6.1zM38.5 22.7l6.7-6.7c.8-.8 1.6-.9 2.1-.9s1.4.1 2.1.9l5.2 5.2c1.1 1.1 1.1 3.1 0 4.2l-6.1 6.1-.2.2-6.5 6.5c1.2.6 2.5.9 3.8.9 2.3 0 4.6-.9 6.3-2.6l6.7-6.7c3.5-3.5 3.5-9.2 0-12.7l-5.2-5.2c-1.7-1.7-4-2.6-6.3-2.6s-4.6.9-6.3 2.6l-6.7 6.7c-2.7 2.7-3.3 6.9-1.7 10.2l6.1-6.1z" /><path d="M44.1 30.7c.2-.2.4-.6.4-.9 0-.3-.1-.6-.4-.9l-2.3-2.3c-.2-.2-.6-.4-.9-.4-.3 0-.6.1-.9.4L25.8 40.8c-.2.2-.4.6-.4.9 0 .3.1.6.4.9l2.3 2.3c.2.2.6.4.9.4.3 0 .6-.1.9-.4l14.2-14.2z" /></symbol><symbol id="trumbowyg-ordered-list" viewBox="0 0 72 72"><path d="M27 14h36v8H27zM27 50h36v8H27zM27 32h36v8H27zM11.8 15.8V22h1.8v-7.8h-1.5l-2.1 1 .3 1.3zM12.1 38.5l.7-.6c1.1-1 2.1-2.1 2.1-3.4 0-1.4-1-2.4-2.7-2.4-1.1 0-2 .4-2.6.8l.5 1.3c.4-.3 1-.6 1.7-.6.9 0 1.3.5 1.3 1.1 0 .9-.9 1.8-2.6 3.3l-1 .9V40H15v-1.5h-2.9zM13.3 53.9c1-.4 1.4-1 1.4-1.8 0-1.1-.9-1.9-2.6-1.9-1 0-1.9.3-2.4.6l.4 1.3c.3-.2 1-.5 1.6-.5.8 0 1.2.3 1.2.8 0 .7-.8.9-1.4.9h-.7v1.3h.7c.8 0 1.6.3 1.6 1.1 0 .6-.5 1-1.4 1-.7 0-1.5-.3-1.8-.5l-.4 1.4c.5.3 1.3.6 2.3.6 2 0 3.2-1 3.2-2.4 0-1.1-.8-1.8-1.7-1.9z" /></symbol><symbol id="trumbowyg-p" viewBox="0 0 72 72"><path d="M47.8 15.1H30.1c-4.7 0-8.5 3.7-8.5 8.4s3.7 8.4 8.4 8.4v25h7V19.8h3v37.1h4.1V19.8h3.7v-4.7z" /></symbol><symbol id="trumbowyg-redo" viewBox="0 0 72 72"><path d="M10.8 51.2c0-5.1 2.1-9.7 5.4-13.1 3.3-3.3 8-5.4 13.1-5.4H46v-12L61.3 36 45.9 51.3V39.1H29.3c-3.3 0-6.4 1.3-8.5 3.5-2.2 2.2-3.5 5.2-3.5 8.5h-6.5z" /></symbol><symbol id="trumbowyg-removeformat" viewBox="0 0 72 72"><path d="M58.2 54.6L52 48.5l3.6-3.6 6.1 6.1 6.4-6.4 3.8 3.8-6.4 6.4 6.1 6.1-3.6 3.6-6.1-6.1-6.4 6.4-3.7-3.8 6.4-6.4zM21.7 52.1H50V57H21.7zM18.8 15.2h34.1v6.4H39.5v24.2h-7.4V21.5H18.8v-6.3z" /></symbol><symbol id="trumbowyg-strikethrough" viewBox="0 0 72 72"><path d="M45.8 45c0 1-.3 1.9-.9 2.8-.6.9-1.6 1.6-3 2.1s-3.1.8-5 .8c-2.1 0-4-.4-5.7-1.1-1.7-.7-2.9-1.7-3.6-2.7-.8-1.1-1.3-2.6-1.5-4.5l-.1-.8-6.7.6v.9c.1 2.8.9 5.4 2.3 7.6 1.5 2.3 3.5 4 6.1 5.1 2.6 1.1 5.7 1.6 9.4 1.6 2.9 0 5.6-.5 8-1.6 2.4-1.1 4.3-2.7 5.6-4.7 1.3-2 2-4.2 2-6.5 0-1.6-.3-3.1-.9-4.5l-.2-.6H44c0 .1 1.8 2.3 1.8 5.5zM29 28.9c-.8-.8-1.2-1.7-1.2-2.9 0-.7.1-1.3.4-1.9.3-.6.7-1.1 1.4-1.6.6-.5 1.4-.9 2.5-1.1 1.1-.3 2.4-.4 3.9-.4 2.9 0 5 .6 6.3 1.7 1.3 1.1 2.1 2.7 2.4 5.1l.1.9 6.8-.5v-.9c-.1-2.5-.8-4.7-2.1-6.7s-3.2-3.5-5.6-4.5c-2.4-1-5.1-1.5-8.1-1.5-2.8 0-5.3.5-7.6 1.4-2.3 1-4.2 2.4-5.4 4.3-1.2 1.9-1.9 3.9-1.9 6.1 0 1.7.4 3.4 1.2 4.9l.3.5h11.8c-2.3-.9-3.9-1.7-5.2-2.9zm13.3-6.2zM22.7 20.3zM13 34.1h46.1v3.4H13z" /></symbol><symbol id="trumbowyg-strong" viewBox="0 0 72 72"><path d="M51.1 37.8c-1.1-1.4-2.5-2.5-4.2-3.3 1.2-.8 2.1-1.8 2.8-3 1-1.6 1.5-3.5 1.5-5.3 0-2-.6-4-1.7-5.8-1.1-1.8-2.8-3.2-4.8-4.1-2-.9-4.6-1.3-7.8-1.3h-16v42h16.3c2.6 0 4.8-.2 6.7-.7 1.9-.5 3.4-1.2 4.7-2.1 1.3-1 2.4-2.4 3.2-4.1.9-1.7 1.3-3.6 1.3-5.7.2-2.5-.5-4.7-2-6.6zM40.8 50.2c-.6.1-1.8.2-3.4.2h-9V38.5h8.3c2.5 0 4.4.2 5.6.6 1.2.4 2 1 2.7 2 .6.9 1 2 1 3.3 0 1.1-.2 2.1-.7 2.9-.5.9-1 1.5-1.7 1.9-.8.4-1.7.8-2.8 1zm2.6-20.4c-.5.7-1.3 1.3-2.5 1.6-.8.3-2.5.4-4.8.4h-7.7V21.6h7.1c1.4 0 2.6 0 3.6.1s1.7.2 2.2.4c1 .3 1.7.8 2.2 1.7.5.9.8 1.8.8 3-.1 1.3-.4 2.2-.9 3z" /></symbol><symbol id="trumbowyg-subscript" viewBox="0 0 72 72"><path d="M32 15h7.8L56 57.1h-7.9L44.3 46H27.4l-4 11.1h-7.6L32 15zm-2.5 25.4h12.9L36 22.3h-.2l-6.3 18.1zM58.7 59.9c.6-1.4 2-2.8 4.1-4.4 1.9-1.3 3.1-2.3 3.7-2.9.8-.9 1.3-1.9 1.3-3 0-.9-.2-1.6-.7-2.2-.5-.6-1.2-.9-2.1-.9-1.2 0-2.1.5-2.5 1.4-.3.5-.4 1.4-.5 2.5h-4c.1-1.8.4-3.2 1-4.3 1.1-2.1 3-3.1 5.8-3.1 2.2 0 3.9.6 5.2 1.8 1.3 1.2 1.9 2.8 1.9 4.8 0 1.5-.5 2.9-1.4 4.1-.6.8-1.6 1.7-3 2.6L66 57.7c-1 .7-1.7 1.2-2.1 1.6-.4.3-.7.7-1 1.1H72V64H57.8c0-1.5.3-2.8.9-4.1z" /></symbol><symbol id="trumbowyg-superscript" viewBox="0 0 72 72"><path d="M32 15h7.8L56 57.1h-7.9l-4-11.1H27.4l-4 11.1h-7.6L32 15zm-2.5 25.4h12.9L36 22.3h-.2l-6.3 18.1zM49.6 28.8c.5-1.1 1.6-2.3 3.4-3.6 1.5-1.1 2.5-1.9 3-2.4.7-.7 1-1.6 1-2.4 0-.7-.2-1.3-.6-1.8-.4-.5-1-.7-1.7-.7-1 0-1.7.4-2.1 1.1-.2.4-.3 1.1-.4 2.1H49c.1-1.5.3-2.6.8-3.5.9-1.7 2.5-2.6 4.8-2.6 1.8 0 3.2.5 4.3 1.5 1.1 1 1.6 2.3 1.6 4 0 1.3-.4 2.4-1.1 3.4-.5.7-1.3 1.4-2.4 2.2l-1.3 1c-.8.6-1.4 1-1.7 1.3-.3.3-.6.6-.8.9h7.4v3H48.8c0-1.3.3-2.4.8-3.5z" /></symbol><symbol id="trumbowyg-underline" viewBox="0 0 72 72"><path d="M36 35zM15.2 55.9h41.6V59H15.2zM21.1 13.9h6.4v21.2c0 1.2.1 2.5.2 3.7.1 1.3.5 2.4 1 3.4.6 1 1.4 1.8 2.6 2.5 1.1.6 2.7 1 4.8 1 2.1 0 3.7-.3 4.8-1 1.1-.6 2-1.5 2.6-2.5.6-1 .9-2.1 1-3.4.1-1.3.2-2.5.2-3.7V13.9H51v23.3c0 2.3-.4 4.4-1.1 6.1-.7 1.7-1.7 3.2-3 4.4-1.3 1.2-2.9 2-4.7 2.6-1.8.6-3.9.9-6.1.9-2.2 0-4.3-.3-6.1-.9-1.8-.6-3.4-1.5-4.7-2.6-1.3-1.2-2.3-2.6-3-4.4-.7-1.7-1.1-3.8-1.1-6.1V13.9z" /></symbol><symbol id="trumbowyg-undo" viewBox="0 0 72 72"><path d="M61.2 51.2c0-5.1-2.1-9.7-5.4-13.1-3.3-3.3-8-5.4-13.1-5.4H26.1v-12L10.8 36l15.3 15.3V39.1h16.7c3.3 0 6.4 1.3 8.5 3.5 2.2 2.2 3.5 5.2 3.5 8.5h6.4z" /></symbol><symbol id="trumbowyg-unlink" viewBox="0 0 72 72"><path d="M30.9 49.1l-6.7 6.7c-.8.8-1.6.9-2.1.9s-1.4-.1-2.1-.9l-5.2-5.2c-1.1-1.1-1.1-3.1 0-4.2l6.1-6.1.2-.2 6.5-6.5c-1.2-.6-2.5-.9-3.8-.9-2.3 0-4.6.9-6.3 2.6L10.8 42c-3.5 3.5-3.5 9.2 0 12.7l5.2 5.2c1.7 1.7 4 2.6 6.3 2.6s4.6-.9 6.3-2.6l6.7-6.7C38 50.5 38.6 46.3 37 43l-6.1 6.1zM38.5 22.7l6.7-6.7c.8-.8 1.6-.9 2.1-.9s1.4.1 2.1.9l5.2 5.2c1.1 1.1 1.1 3.1 0 4.2l-6.1 6.1-.2.2-6.5 6.5c1.2.6 2.5.9 3.8.9 2.3 0 4.6-.9 6.3-2.6l6.7-6.7c3.5-3.5 3.5-9.2 0-12.7l-5.2-5.2c-1.7-1.7-4-2.6-6.3-2.6s-4.6.9-6.3 2.6l-6.7 6.7c-2.7 2.7-3.3 6.9-1.7 10.2l6.1-6.1z" /><path d="M44.1 30.7c.2-.2.4-.6.4-.9 0-.3-.1-.6-.4-.9l-2.3-2.3c-.2-.2-.6-.4-.9-.4-.3 0-.6.1-.9.4L25.8 40.8c-.2.2-.4.6-.4.9 0 .3.1.6.4.9l2.3 2.3c.2.2.6.4.9.4.3 0 .6-.1.9-.4l14.2-14.2zM41.3 55.8v-5h22.2v5H41.3z" /></symbol><symbol id="trumbowyg-unordered-list" viewBox="0 0 72 72"><path d="M27 14h36v8H27zM27 50h36v8H27zM9 50h9v8H9zM9 32h9v8H9zM9 14h9v8H9zM27 32h36v8H27z" /></symbol><symbol id="trumbowyg-view-html" viewBox="0 0 72 72"><path fill="none" stroke="currentColor" stroke-width="8" stroke-miterlimit="10" d="M26.9 17.9L9 36.2 26.9 54M45 54l17.9-18.3L45 17.9" /></symbol><symbol id="trumbowyg-base64" viewBox="0 0 72 72"><path d="M64 17v38H8V17h56m8-8H0v54h72V9z" /><path d="M29.9 28.9c-.5-.5-1.1-.8-1.8-.8s-1.4.2-1.9.7c-.5.4-.9 1-1.2 1.6-.3.6-.5 1.3-.6 2.1-.1.7-.2 1.4-.2 1.9l.1.1c.6-.8 1.2-1.4 2-1.8.8-.4 1.7-.5 2.7-.5.9 0 1.8.2 2.6.6.8.4 1.6.9 2.2 1.5.6.6 1 1.3 1.2 2.2.3.8.4 1.6.4 2.5 0 1.1-.2 2.1-.5 3-.3.9-.8 1.7-1.5 2.4-.6.7-1.4 1.2-2.3 1.6-.9.4-1.9.6-3 .6-1.6 0-2.8-.3-3.9-.9-1-.6-1.8-1.4-2.5-2.4-.6-1-1-2.1-1.3-3.4-.2-1.3-.4-2.6-.4-3.9 0-1.3.1-2.6.4-3.8.3-1.3.8-2.4 1.4-3.5.7-1 1.5-1.9 2.5-2.5 1-.6 2.3-1 3.8-1 .9 0 1.7.1 2.5.4.8.3 1.4.6 2 1.1.6.5 1.1 1.1 1.4 1.8.4.7.6 1.5.7 2.5h-4c0-1-.3-1.6-.8-2.1zm-3.5 6.8c-.4.2-.8.5-1 .8-.3.4-.5.8-.6 1.2-.1.5-.2 1-.2 1.5s.1.9.2 1.4c.1.5.4.9.6 1.2.3.4.6.7 1 .9.4.2.9.3 1.4.3.5 0 1-.1 1.3-.3.4-.2.7-.5 1-.9.3-.4.5-.8.6-1.2.1-.5.2-.9.2-1.4 0-.5-.1-1-.2-1.4-.1-.5-.3-.9-.6-1.2-.3-.4-.6-.7-1-.9-.4-.2-.9-.3-1.4-.3-.4 0-.9.1-1.3.3zM36.3 41.3v-3.8l9-12.1H49v12.4h2.7v3.5H49v4.8h-4v-4.8h-8.7zM45 30.7l-5.3 7.2h5.4l-.1-7.2z" /></symbol><symbol id="trumbowyg-back-color" viewBox="0 0 72 72"><path d="M36.5 22.3l-6.3 18.1H43l-6.3-18.1z" /><path d="M9 8.9v54.2h54.1V8.9H9zm39.9 48.2L45 46H28.2l-3.9 11.1h-7.6L32.8 15h7.8l16.2 42.1h-7.9z" /></symbol><symbol id="trumbowyg-fore-color" viewBox="0 0 72 72"><path d="M32 15h7.8L56 57.1h-7.9l-4-11.1H27.4l-4 11.1h-7.6L32 15zm-2.5 25.4h12.9L36 22.3h-.2l-6.3 18.1z" /></symbol><symbol id="trumbowyg-fontsize" viewBox="0 0 24 24"><path d="M9 4v3h5v12h3V7h5V4H9zm-6 8h3v7h3v-7h3V9H3v3z" /></symbol><symbol id="trumbowyg-emoji" viewBox="0 0 72 72"><path d="M36.05 9C21.09 9 8.949 21.141 8.949 36.101c0 14.96 12.141 27.101 27.101 27.101 14.96 0 27.101-12.141 27.101-27.101S51.01 9 36.05 9zm9.757 15.095c2.651 0 4.418 1.767 4.418 4.418s-1.767 4.418-4.418 4.418-4.418-1.767-4.418-4.418 1.767-4.418 4.418-4.418zm-19.479 0c2.651 0 4.418 1.767 4.418 4.418s-1.767 4.418-4.418 4.418-4.418-1.767-4.418-4.418 1.767-4.418 4.418-4.418zm9.722 30.436c-14.093 0-16.261-13.009-16.261-13.009h32.522S50.143 54.531 36.05 54.531z" /></symbol><symbol id="trumbowyg-highlight" viewBox="0 0 60 60"><path d="M11 7c0-2.206-1.794-4-4-4S3 4.794 3 7s1.794 4 4 4 4-1.794 4-4zM7 9c-1.103 0-2-.897-2-2s.897-2 2-2 2 .897 2 2-.897 2-2 2zM16 11c2.206 0 4-1.794 4-4s-1.794-4-4-4-4 1.794-4 4 1.794 4 4 4zm0-6c1.103 0 2 .897 2 2s-.897 2-2 2-2-.897-2-2 .897-2 2-2zM25 11c2.206 0 4-1.794 4-4s-1.794-4-4-4-4 1.794-4 4 1.794 4 4 4zm0-6c1.103 0 2 .897 2 2s-.897 2-2 2-2-.897-2-2 .897-2 2-2z" /><path d="M0 0v60h60V0H0zm2 2h56v10H2V2zm0 56V14h5v44H2zm56 0H9V14h49v44z" /><path d="M5 17H4a1 1 0 1 0 0 2h1a1 1 0 1 0 0-2zM5 21H4a1 1 0 1 0 0 2h1a1 1 0 1 0 0-2zM5 25H4a1 1 0 1 0 0 2h1a1 1 0 1 0 0-2zM5 29H4a1 1 0 1 0 0 2h1a1 1 0 1 0 0-2zM5 33H4a1 1 0 1 0 0 2h1a1 1 0 1 0 0-2zM5 37H4a1 1 0 1 0 0 2h1a1 1 0 1 0 0-2zM5 41H4a1 1 0 1 0 0 2h1a1 1 0 1 0 0-2zM5 45H4a1 1 0 1 0 0 2h1a1 1 0 1 0 0-2zM5 49H4a1 1 0 1 0 0 2h1a1 1 0 1 0 0-2zM5 53H4a1 1 0 1 0 0 2h1a1 1 0 1 0 0-2zM13 19h13a1 1 0 1 0 0-2H13a1 1 0 1 0 0 2zM30 19h10a1 1 0 1 0 0-2H30a1 1 0 1 0 0 2zM44 19h2a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2zM35 22a1 1 0 0 0 1 1h15a1 1 0 1 0 0-2H36a1 1 0 0 0-1 1zM32 21H18a1 1 0 1 0 0 2h14a1 1 0 1 0 0-2zM13 23h1a1 1 0 1 0 0-2h-1a1 1 0 1 0 0 2zM13 27h9a1 1 0 1 0 0-2h-9a1 1 0 1 0 0 2zM26 27h2a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2zM46 25H32a1 1 0 1 0 0 2h14a1 1 0 1 0 0-2zM13 31h13a1 1 0 1 0 0-2H13a1 1 0 1 0 0 2zM41 30a1 1 0 0 0-1-1H30a1 1 0 1 0 0 2h10a1 1 0 0 0 1-1zM36 35h8a1 1 0 1 0 0-2h-8a1 1 0 1 0 0 2zM17 34a1 1 0 0 0 1 1h14a1 1 0 1 0 0-2H18a1 1 0 0 0-1 1zM13 35h1a1 1 0 1 0 0-2h-1a1 1 0 1 0 0 2zM13 39h9a1 1 0 1 0 0-2h-9a1 1 0 1 0 0 2zM26 39h2a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2zM31 38a1 1 0 0 0 1 1h15a1 1 0 1 0 0-2H32a1 1 0 0 0-1 1zM13 43h13a1 1 0 1 0 0-2H13a1 1 0 1 0 0 2zM40 41H30a1 1 0 1 0 0 2h10a1 1 0 1 0 0-2zM51 41h-7a1 1 0 1 0 0 2h7a1 1 0 1 0 0-2zM40 45h-4a1 1 0 1 0 0 2h4a1 1 0 1 0 0-2zM17 46a1 1 0 0 0 1 1h14a1 1 0 1 0 0-2H18a1 1 0 0 0-1 1zM13 47h1a1 1 0 1 0 0-2h-1a1 1 0 1 0 0 2zM22 49h-9a1 1 0 1 0 0 2h9a1 1 0 1 0 0-2zM28 49h-2a1 1 0 1 0 0 2h2a1 1 0 1 0 0-2zM39 49h-7a1 1 0 1 0 0 2h7a1 1 0 1 0 0-2zM44 49h-1a1 1 0 1 0 0 2h1a1 1 0 1 0 0-2z" /></symbol><symbol id="trumbowyg-giphy" viewBox="0 0 72 72"><g fill-rule="nonzero"><path d="M15.676 40.149v-5.282h13.645v12.489c-1.326 1.283-3.248 2.413-5.764 3.39-2.516.977-5.065 1.465-7.646 1.465-3.279 0-6.137-.688-8.575-2.064-2.439-1.376-4.271-3.343-5.497-5.903C.613 41.685 0 38.901 0 35.893c0-3.265.684-6.166 2.053-8.704 1.369-2.538 3.372-4.484 6.01-5.839 2.01-1.04 4.512-1.561 7.506-1.561 3.893 0 6.933.816 9.122 2.449 2.188 1.632 3.596 3.889 4.223 6.769l-6.287 1.176c-.442-1.54-1.273-2.755-2.492-3.646-1.219-.892-2.741-1.337-4.566-1.337-2.766 0-4.965.877-6.597 2.63-1.633 1.754-2.449 4.356-2.449 7.806 0 3.722.827 6.513 2.481 8.373 1.654 1.861 3.821 2.791 6.501 2.791 1.326 0 2.656-.26 3.989-.781 1.333-.52 2.477-1.151 3.432-1.892v-3.978h-7.25zM36.568 20.324h6.33v31.352h-6.33zM50.507 51.676V20.324H72v5.304H56.837v7.421h13.089v5.303H56.837v13.324h-6.33z" /></g></symbol><symbol id="trumbowyg-insert-audio" viewBox="-2 -2 12 12"><path d="M3.344 0L2 2H0v4h2l1.344 2H4V0h-.656zM5 1v1c.152 0 .313.026.469.063H5.5c.86.215 1.5.995 1.5 1.938a1.99 1.99 0 0 1-2 2.001v1a2.988 2.988 0 0 0 3-3 2.988 2.988 0 0 0-3-3zm0 2v2l.25-.031C5.683 4.851 6 4.462 6 4c0-.446-.325-.819-.75-.938v-.031h-.031L5 3z" /></symbol><symbol id="trumbowyg-lineheight" viewBox="0 0 72 72"><path fill="currentColor" d="M31 14h36v8H31zm0 36h36v8H31zm0-18h30v8H31z" /><path fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="3.643" d="M7.82 47.207l8.332 8.15 8.106-8.15m.018-22.572l-8.333-8.15-8.105 8.15" /><path fill="currentColor" d="M14.348 53.761v-36h3.384v36z" /></symbol><symbol id="trumbowyg-mathml" viewBox="0 0 445.878 445.878"><path d="M426.024 86.447H209.705l-84.911 298.911c-2.568 7.967-9.854 13.482-18.22 13.771-.236 0-.464.006-.688.006a19.868 19.868 0 0 1-18.436-12.478l-34.714-86.782H19.851C8.884 299.876 0 290.986 0 280.022c0-10.965 8.893-19.854 19.851-19.854H66.18a19.862 19.862 0 0 1 18.436 12.483l19.237 48.09 72.472-260.218a19.855 19.855 0 0 1 18.903-13.781h230.798c10.97 0 19.854 8.89 19.854 19.851s-8.892 19.854-19.856 19.854zm10.699 266.78l-78.259-87.904 74.576-82.783c1.318-1.454 1.638-3.547.857-5.341a4.977 4.977 0 0 0-4.54-2.946h-47.18a4.995 4.995 0 0 0-3.759 1.72l-50.059 58.047-49.674-58.029a4.95 4.95 0 0 0-3.771-1.738H225.58a4.947 4.947 0 0 0-4.521 2.929 4.939 4.939 0 0 0 .824 5.332l73.743 82.81-77.641 87.923a4.977 4.977 0 0 0-.813 5.325 4.978 4.978 0 0 0 4.528 2.92h48.9c1.472 0 2.867-.65 3.807-1.785l51.819-62.181 53.05 62.229a4.972 4.972 0 0 0 3.782 1.743h49.97a4.938 4.938 0 0 0 4.527-2.926 4.966 4.966 0 0 0-.832-5.345z" /></symbol><symbol id="trumbowyg-mention" viewBox="0 0 128 128"><path fill-rule="evenodd" d="M73.309 62.5c-1.53 9.86-8.16 17.85-14.45 17.85-5.61 0-8.5-4.08-8.5-10.54 0-13.089 8.84-24.139 20.06-24.139 2.21 0 3.91.34 5.27.68L73.309 62.5zm14.45 44.2c-6.8 3.57-15.98 5.44-24.65 5.44-25.329 0-43.519-16.15-43.519-44.54 0-32.469 22.78-52.869 48.789-52.869 26.35 0 40.63 17.17 40.63 39.27 0 19.549-9.18 28.899-16.49 28.729-4.76-.17-5.95-4.76-4.25-14.79l5.1-31.449c-4.25-2.38-12.75-4.25-20.23-4.25-24.48 0-39.779 18.87-39.779 39.609 0 13.94 7.99 22.1 19.039 22.1 9.01 0 16.66-4.42 21.93-13.09h.34c.85 9.01 6.63 13.09 14.62 13.09 18.36 0 32.3-15.64 32.3-40.459 0-28.56-21.42-49.13-51.34-49.13C31.83 4.361 6.67 34.451 6.67 69.13c0 33.32 24.82 53.55 53.039 53.55 12.07 0 20.91-1.53 31.11-6.12l-3.06-9.86z" /></symbol><symbol id="trumbowyg-noembed" viewBox="0 0 72 72"><path d="M31.5 33.6V25l11 11-11 11v-8.8z" /><path d="M64 17v38H8V17h56m8-8H0v54h72V9z" /></symbol><symbol id="trumbowyg-preformatted" viewBox="0 0 72 72"><path d="M10.3 33.5c.4 0 .9-.1 1.5-.2s1.2-.3 1.8-.7c.6-.3 1.1-.8 1.5-1.3.4-.5.6-1.3.6-2.1V17.1c0-1.4.3-2.6.8-3.6s1.2-1.9 2-2.5c.8-.7 1.6-1.2 2.5-1.5.9-.3 1.6-.5 2.2-.5h5.3v5.3h-3.2c-.7 0-1.3.1-1.8.4-.4.3-.8.6-1 1-.2.4-.4.9-.4 1.3-.1.5-.1.9-.1 1.4v11.4c0 1.2-.2 2.1-.7 2.9-.5.8-1 1.4-1.7 1.8-.6.4-1.3.8-2 1-.7.2-1.3.3-1.7.4v.1c.5 0 1 .1 1.7.3.7.2 1.3.5 2 .9.6.5 1.2 1.1 1.7 1.9.5.8.7 2 .7 3.4v11.1c0 .4 0 .9.1 1.4.1.5.2.9.4 1.3s.6.7 1 1c.4.3 1 .4 1.8.4h3.2V63h-5.3c-.6 0-1.4-.2-2.2-.5-.9-.3-1.7-.8-2.5-1.5s-1.4-1.5-2-2.5c-.5-1-.8-2.2-.8-3.6V43.5c0-.9-.2-1.7-.6-2.3-.4-.6-.9-1.1-1.5-1.5-.6-.4-1.2-.6-1.8-.7-.6-.1-1.1-.2-1.5-.2v-5.3zM61.8 38.7c-.4 0-1 .1-1.6.2-.6.1-1.2.4-1.8.7-.6.3-1.1.7-1.5 1.3-.4.5-.6 1.3-.6 2.1v12.1c0 1.4-.3 2.6-.8 3.6s-1.2 1.9-2 2.5c-.8.7-1.6 1.2-2.5 1.5-.9.3-1.6.5-2.2.5h-5.3v-5.3h3.2c.7 0 1.3-.1 1.8-.4.4-.3.8-.6 1-1 .2-.4.4-.9.4-1.3.1-.5.1-.9.1-1.4V42.3c0-1.2.2-2.1.7-2.9.5-.8 1-1.4 1.7-1.8.6-.4 1.3-.8 2-1 .7-.2 1.3-.3 1.7-.4v-.1c-.5 0-1-.1-1.7-.3-.7-.2-1.3-.5-2-.9-.6-.4-1.2-1.1-1.7-1.9-.5-.8-.7-2-.7-3.4V18.5c0-.4 0-.9-.1-1.4-.1-.5-.2-.9-.4-1.3s-.6-.7-1-1c-.4-.3-1-.4-1.8-.4h-3.2V9.1h5.3c.6 0 1.4.2 2.2.5.9.3 1.7.8 2.5 1.5s1.4 1.5 2 2.5c.5 1 .8 2.2.8 3.6v11.6c0 .9.2 1.7.6 2.3.4.6.9 1.1 1.5 1.5.6.4 1.2.6 1.8.7.6.1 1.2.2 1.6.2v5.2z" /></symbol><symbol id="trumbowyg-ruby" viewBox="0 0 72 72"><path d="M16.499 24.477h8.018L41.08 67.5H33l-4.04-11.361H11.804L7.764 67.5H0l16.499-43.023zm-2.65 25.907h13.127l-6.438-18.497h-.177l-6.512 18.497zM65.053 16.685c-6.316 1.178-12.025 1.98-17.126 2.408a362.385 362.385 0 0 0-.965 5.833c-.25 1.57-.679 3.907-1.286 7.013 3.033-1.963 5.852-3.266 8.458-3.907 2.639-.642 4.905-.891 6.797-.75 1.891.108 3.746.661 5.566 1.661 1.82.964 3.264 2.408 4.334 4.334 1.104 1.893 1.427 4.088.965 6.584-.466 2.461-1.554 4.494-3.265 6.101-1.679 1.605-3.658 2.783-5.941 3.532-2.283.785-4.853 1.251-7.707 1.391-2.819.144-5.906.161-9.259.056 0-1.642-.287-3.212-.857-4.71l.108-.59c2.711.5 5.246.768 7.601.802 2.39 0 4.529-.195 6.421-.589 1.927-.393 3.605-1.069 5.031-2.031 1.427-.965 2.319-2.319 2.676-4.067.394-1.75.269-3.229-.373-4.443-.644-1.249-1.446-2.213-2.408-2.891-.929-.68-2.161-1.034-3.693-1.071-1.536-.072-3.265.089-5.192.482-1.927.391-3.82 1.14-5.672 2.248a24.308 24.308 0 0 0-4.978 3.907l-4.872-1.981c1.463-5.031 2.355-8.597 2.677-10.703.321-2.105.642-4.067.963-5.887-3.961.25-7.154.411-9.58.481-.215-1.927-.52-3.534-.91-4.817l.32-.32c3.604.32 7.225.446 10.865.375.214-1.355.481-3.103.804-5.245.354-2.175.407-3.621.16-4.336.034-.784.374-1.017 1.017-.695l5.085.749c.428.251.444.573.055.964l-.857.91c-.537 2.89-.981 5.352-1.338 7.385 4.279-.427 9.312-1.393 15.092-2.89l1.284 4.707" /></symbol><symbol id="trumbowyg-special-chars" viewBox="0 0 72 72"><text style="text-align:start;line-height:125%" x="6.03" y="48.528" transform="scale(1.0117 .98844)" font-size="60.056" font-weight="400" font-family="Times New Roman"><tspan x="6.03" y="48.528">™</tspan></text></symbol><symbol id="trumbowyg-col-delete" viewBox="0 0 24 24"><g transform="translate(-326 -532.36)"><rect width="6" height="15" x="335" y="537.36" fill="#ed5565" stroke="#000" stroke-linejoin="round" stroke-linecap="round" stroke-width=".837" rx=".646" /><path d="M347.58 536.498c-.051-.618-.55-1.138-1.178-1.138H329.6c-.628 0-1.127.52-1.18 1.138h-.02v15.663a1.2 1.2 0 0 0 1.2 1.2h16.801a1.2 1.2 0 0 0 1.2-1.2v-15.663h-.021M334.4 552.16h-4.8v-3.6h4.8v3.6m0-4.7h-4.8v-3.7h4.8v3.7m0-4.9h-4.8v-3.601h4.8v3.6m6 9.601h-4.8v-3.6h4.8v3.6m0-4.7h-4.8v-3.7h4.8v3.7m0-4.9h-4.8v-3.601h4.8v3.6m6.001 9.601h-4.8v-3.6h4.8v3.6m0-4.7h-4.8v-3.7h4.8v3.7m0-4.9h-4.8v-3.601h4.8v3.6" /></g></symbol><symbol id="trumbowyg-col-left" viewBox="0 0 24 24"><g transform="translate(-326 -532.36)"><rect width="6" height="15" x="329" y="537.36" fill="#1ab394" stroke="#000" stroke-linejoin="round" stroke-linecap="round" stroke-width=".837" rx=".646" /><path d="M347.58 536.498c-.051-.618-.55-1.138-1.178-1.138H329.6c-.628 0-1.127.52-1.18 1.138h-.02v15.663a1.2 1.2 0 0 0 1.2 1.2h16.801a1.2 1.2 0 0 0 1.2-1.2v-15.663h-.021M334.4 552.16h-4.8v-3.6h4.8v3.6m0-4.7h-4.8v-3.7h4.8v3.7m0-4.9h-4.8v-3.601h4.8v3.6m6 9.601h-4.8v-3.6h4.8v3.6m0-4.7h-4.8v-3.7h4.8v3.7m0-4.9h-4.8v-3.601h4.8v3.6m6.001 9.601h-4.8v-3.6h4.8v3.6m0-4.7h-4.8v-3.7h4.8v3.7m0-4.9h-4.8v-3.601h4.8v3.6" /></g></symbol><symbol id="trumbowyg-col-right" viewBox="0 0 24 24"><g transform="matrix(-1 0 0 1 350 -532.36)"><rect y="537.36" x="329" height="15" width="6" fill="#1ab394" stroke="#000" stroke-linejoin="round" stroke-linecap="round" stroke-width=".837" rx=".646" /><path d="M347.58 536.498c-.051-.618-.55-1.138-1.178-1.138H329.6c-.628 0-1.127.52-1.18 1.138h-.02v15.663a1.2 1.2 0 0 0 1.2 1.2h16.801a1.2 1.2 0 0 0 1.2-1.2v-15.663h-.021M334.4 552.16h-4.8v-3.6h4.8v3.6m0-4.7h-4.8v-3.7h4.8v3.7m0-4.9h-4.8v-3.601h4.8v3.6m6 9.601h-4.8v-3.6h4.8v3.6m0-4.7h-4.8v-3.7h4.8v3.7m0-4.9h-4.8v-3.601h4.8v3.6m6.001 9.601h-4.8v-3.6h4.8v3.6m0-4.7h-4.8v-3.7h4.8v3.7m0-4.9h-4.8v-3.601h4.8v3.6" /></g></symbol><symbol id="trumbowyg-row-above" viewBox="0 0 24 24"><rect y="-347" x="537.06" height="18" width="6" transform="matrix(0 1 1 0 350 -532.36)" fill="#1ab394" stroke="#000" stroke-linejoin="round" stroke-linecap="round" stroke-width=".917" rx=".776" /><path d="M2.42 4.138C2.47 3.52 2.97 3 3.598 3H20.4c.628 0 1.127.52 1.18 1.138h.02V19.8a1.2 1.2 0 0 1-1.2 1.2H3.599a1.2 1.2 0 0 1-1.2-1.2V4.138h.021M15.6 19.8h4.8v-3.6h-4.8v3.6m0-4.7h4.8v-3.7h-4.8v3.7m0-4.9h4.8V6.6h-4.8v3.6m-6 9.601h4.8v-3.6H9.6v3.6m0-4.7h4.8v-3.7H9.6v3.7m0-4.9h4.8V6.6H9.6v3.6m-6.001 9.601h4.8v-3.6H3.6v3.6m0-4.7h4.8v-3.7H3.6v3.7m0-4.9h4.8V6.6H3.6v3.6" /></symbol><symbol id="trumbowyg-row-below" viewBox="0 0 24 24"><rect y="-347.06" x="548.4" height="18.13" width="4.427" transform="matrix(0 1 1 0 350 -532.36)" fill="#1ab394" stroke="#000" stroke-linejoin="round" stroke-linecap="round" stroke-width=".79" rx=".781" /><path d="M2.42 4.138C2.47 3.52 2.97 3 3.598 3H20.4c.628 0 1.127.52 1.18 1.138h.02V19.8a1.2 1.2 0 0 1-1.2 1.2H3.599a1.2 1.2 0 0 1-1.2-1.2V4.138h.021M15.6 19.8h4.8v-3.6h-4.8v3.6m0-4.7h4.8v-3.7h-4.8v3.7m0-4.9h4.8V6.6h-4.8v3.6m-6 9.601h4.8v-3.6H9.6v3.6m0-4.7h4.8v-3.7H9.6v3.7m0-4.9h4.8V6.6H9.6v3.6m-6.001 9.601h4.8v-3.6H3.6v3.6m0-4.7h4.8v-3.7H3.6v3.7m0-4.9h4.8V6.6H3.6v3.6" /></symbol><symbol id="trumbowyg-row-delete" viewBox="0 0 24 24"><rect width="5" height="18" x="543.36" y="-347" transform="rotate(90 103.18 -429.18)" fill="#ed5565" rx=".776" /><path d="M21.58 4.136c-.051-.618-.55-1.138-1.178-1.138H3.6c-.628 0-1.127.52-1.18 1.138H2.4v15.663A1.2 1.2 0 0 0 3.6 21h16.801a1.2 1.2 0 0 0 1.2-1.2V4.136h-.021M8.4 19.799H3.6v-3.6h4.8v3.6m0-4.7H3.6v-3.7h4.8v3.7m0-4.9H3.6V6.597h4.8v3.6m6 9.601H9.6v-3.6h4.8v3.6m0-4.7H9.6v-3.7h4.8v3.7m0-4.9H9.6V6.597h4.8v3.6m6.001 9.601h-4.8v-3.6h4.8v3.6m0-4.7h-4.8v-3.7h4.8v3.7m0-4.9h-4.8V6.597h4.8v3.6" /></symbol><symbol id="trumbowyg-table-delete" viewBox="0 0 24 24"><rect y="-347" x="537.06" height="18" width="6" transform="matrix(0 1 1 0 350 -532.36)" fill="#ed5565" stroke="#000" stroke-linejoin="round" stroke-linecap="round" stroke-width=".917" rx=".776" /><rect width="5" height="18" x="543.36" y="-347" transform="rotate(90 103.18 -429.18)" fill="#ed5565" rx=".776" /><rect y="-347.06" x="548.4" height="18.13" width="4.427" transform="matrix(0 1 1 0 350 -532.36)" fill="#ed5565" stroke="#000" stroke-linejoin="round" stroke-linecap="round" stroke-width=".79" rx=".781" /><path d="M21.58 4.136c-.051-.618-.55-1.138-1.178-1.138H3.6c-.628 0-1.127.52-1.18 1.138H2.4v15.663A1.2 1.2 0 0 0 3.6 21h16.801a1.2 1.2 0 0 0 1.2-1.2V4.136h-.021M8.4 19.799H3.6v-3.6h4.8v3.6m0-4.7H3.6v-3.7h4.8v3.7m0-4.9H3.6V6.597h4.8v3.6m6 9.601H9.6v-3.6h4.8v3.6m0-4.7H9.6v-3.7h4.8v3.7m0-4.9H9.6V6.597h4.8v3.6m6.001 9.601h-4.8v-3.6h4.8v3.6m0-4.7h-4.8v-3.7h4.8v3.7m0-4.9h-4.8V6.597h4.8v3.6" /></symbol><symbol id="trumbowyg-table" viewBox="0 0 72 72"><path d="M25.686 51.38v-6.347q0-.462-.297-.76-.298-.297-.761-.297H14.04q-.463 0-.761.297-.298.298-.298.76v6.346q0 .463.298.76.298.298.76.298h10.589q.463 0 .76-.298.298-.297.298-.76zm0-12.692v-6.346q0-.463-.297-.76-.298-.298-.761-.298H14.04q-.463 0-.761.298-.298.297-.298.76v6.346q0 .462.298.76.298.297.76.297h10.589q.463 0 .76-.297.298-.298.298-.76zm16.94 12.691v-6.346q0-.462-.297-.76-.298-.297-.761-.297H30.98q-.463 0-.76.297-.299.298-.299.76v6.346q0 .463.298.76.298.298.761.298h10.588q.463 0 .76-.298.299-.297.299-.76zm-16.94-25.383v-6.345q0-.463-.297-.76-.298-.298-.761-.298H14.04q-.463 0-.761.297-.298.298-.298.76v6.346q0 .463.298.76.298.298.76.298h10.589q.463 0 .76-.298.298-.297.298-.76zm16.94 12.692v-6.346q0-.463-.297-.76-.298-.298-.761-.298H30.98q-.463 0-.76.298-.299.297-.299.76v6.346q0 .462.298.76.298.297.761.297h10.588q.463 0 .76-.297.299-.298.299-.76zm16.94 12.691v-6.346q0-.462-.297-.76-.298-.297-.76-.297H47.92q-.463 0-.76.297-.298.298-.298.76v6.346q0 .463.297.76.298.298.761.298h10.588q.463 0 .761-.298.298-.297.298-.76zm-16.94-25.383v-6.345q0-.463-.297-.76-.298-.298-.761-.298H30.98q-.463 0-.76.297-.299.298-.299.76v6.346q0 .463.298.76.298.298.761.298h10.588q.463 0 .76-.298.299-.297.299-.76zm16.94 12.692v-6.346q0-.463-.297-.76-.298-.298-.76-.298H47.92q-.463 0-.76.298-.298.297-.298.76v6.346q0 .462.297.76.298.297.761.297h10.588q.463 0 .761-.297.298-.298.298-.76zm0-12.692v-6.345q0-.463-.297-.76-.298-.298-.76-.298H47.92q-.463 0-.76.297-.298.298-.298.76v6.346q0 .463.297.76.298.298.761.298h10.588q.463 0 .761-.298.298-.297.298-.76zm4.236-10.576v35.96q0 2.18-1.555 3.734-1.555 1.553-3.739 1.553H14.04q-2.184 0-3.739-1.553-1.555-1.553-1.555-3.735V15.42q0-2.181 1.555-3.735 1.555-1.553 3.739-1.553h44.468q2.184 0 3.739 1.553 1.555 1.554 1.555 3.735z" /></symbol><symbol id="trumbowyg-upload" viewBox="0 0 72 72"><path d="M64 27v28H8V27H0v36h72V27h-8z" /><path d="M32.1 6.7h8v33.6h-8z" /><path d="M48 35.9L36 49.6 24 36h24z" /></symbol></svg>' + '</div>');
			t.hasSvg = true;
		}


		/*
		 * When the button is associated to a empty object
		 * fn and title attributes are defined from the button key value
		 *
		 * For example
		 *      foo: {}
		 * is equivalent to :
		 *      foo: {
		 *          fn: 'foo',
		 *          title: this.lang.foo
		 *      }
		 */
		var h = t.lang.header, // Header translation
			isBlinkFunction = function () {
				return (window.chrome || (window.Intl && Intl.v8BreakIterator)) && 'CSS' in window;
			};
		t.btnsDef = {
			viewHTML: {
				fn: 'toggle',
				class: 'trumbowyg-not-disable',
			},

			undo: {
				isSupported: isBlinkFunction,
				key: 'Z'
			},
			redo: {
				isSupported: isBlinkFunction,
				key: 'Y'
			},

			p: {
				fn: 'formatBlock'
			},
			blockquote: {
				fn: 'formatBlock'
			},
			h1: {
				fn: 'formatBlock',
				title: h + ' 1'
			},
			h2: {
				fn: 'formatBlock',
				title: h + ' 2'
			},
			h3: {
				fn: 'formatBlock',
				title: h + ' 3'
			},
			h4: {
				fn: 'formatBlock',
				title: h + ' 4'
			},
			h5: {
				fn: 'formatBlock',
				title: h + ' 5'
			},
			h6: {
				fn: 'formatBlock',
				title: h + ' 6'
			},
			subscript: {
				tag: 'sub'
			},
			superscript: {
				tag: 'sup'
			},

			bold: {
				key: 'B',
				tag: 'b'
			},
			italic: {
				key: 'I',
				tag: 'i'
			},
			underline: {
				tag: 'u'
			},
			strikethrough: {
			//	tag: 'strike'
				tag: 's' // fix by unixman
			},

			strong: {
				fn: 'bold',
				key: 'B'
			},
			em: {
				fn: 'italic',
				key: 'I'
			},
			//-- fix by unixman
		//	del: {
			s: {
			//-- #fix
				fn: 'strikethrough'
			},

			createLink: {
				key: 'K',
				tag: 'a'
			},
			unlink: {},

			insertImage: {},

			justifyLeft: {
				tag: 'left',
				forceCss: true
			},
			justifyCenter: {
				tag: 'center',
				forceCss: true
			},
			justifyRight: {
				tag: 'right',
				forceCss: true
			},
			justifyFull: {
				tag: 'justify',
				forceCss: true
			},

			unorderedList: {
				fn: 'insertUnorderedList',
				tag: 'ul'
			},
			orderedList: {
				fn: 'insertOrderedList',
				tag: 'ol'
			},

			horizontalRule: {
				fn: 'insertHorizontalRule'
			},

			removeformat: {},

			fullscreen: {
				class: 'trumbowyg-not-disable'
			},
			close: {
				fn: 'destroy',
				class: 'trumbowyg-not-disable'
			},

			// Dropdowns
			formatting: {
				dropdown: ['p', 'blockquote', 'h1', 'h2', 'h3', 'h4'],
				ico: 'p'
			},
			link: {
				dropdown: ['createLink', 'unlink']
			}
		};

		// Defaults Options
		t.o = $.extend(true, {}, $trumbowyg.defaultOptions, options);
		if (!t.o.hasOwnProperty('imgDblClickHandler')) {
			t.o.imgDblClickHandler = t.getDefaultImgDblClickHandler();
		}

		t.urlPrefix = t.setupUrlPrefix();

		t.disabled = t.o.disabled || (editorElem.nodeName === 'TEXTAREA' && editorElem.disabled);

		if (options.btns) {
			t.o.btns = options.btns;
		} else if (!t.o.semantic) {
			t.o.btns[3] = ['bold', 'italic', 'underline', 'strikethrough'];
		}

		$.each(t.o.btnsDef, function (btnName, btnDef) {
			t.addBtnDef(btnName, btnDef);
		});

		// put this here in the event it would be merged in with options
		t.eventNamespace = 'trumbowyg-event';

		// Keyboard shortcuts are load in this array
		t.keys = [];

		// Tag to button dynamically hydrated
		t.tagToButton = {};
		t.tagHandlers = [];

		// Admit multiple paste handlers
		t.pasteHandlers = [].concat(t.o.pasteHandlers);

		// Check if browser is IE
		t.isIE = navigator.userAgent.indexOf('MSIE') !== -1 || navigator.appVersion.indexOf('Trident/') !== -1;

		// Check if we are on macOs
		t.isMac = navigator.platform.toUpperCase().indexOf('MAC') !== -1;

		t.init();
	};

	Trumbowyg.prototype = {
		DEFAULT_SEMANTIC_MAP: {
			'b': 'strong',
			'i': 'em',
			//-- fix by unixman
		//	's': 'del',
		//	'strike': 'del',
		//	'div': 'p'
			'del': 's',
			'strike': 's',
			'p': 'div'
			//-- #fix
		},

		init: function () {
			var t = this;
			t.height = t.$ta.height();

			t.initPlugins();

			try {
				// Disable image resize, try-catch for old IE
				t.doc.execCommand('enableObjectResizing', false, false);
				t.doc.execCommand('defaultParagraphSeparator', false, 'p');
			} catch (e) {
			}

			t.buildEditor();
			t.buildBtnPane();

			t.fixedBtnPaneEvents();

			t.buildOverlay();

			setTimeout(function () {
				if (t.disabled) {
					t.setDisabled(true);
				}
				t.$c.trigger('tbwinit');
			});
		},

		addBtnDef: function (btnName, btnDef) {
			this.btnsDef[btnName] = $.extend(btnDef, this.btnsDef[btnName] || {});
		},

		setupUrlPrefix: function () {
			var protocol = this.o.urlProtocol;
			if (!protocol) {
				return;
			}

			if (typeof(protocol) !== 'string') {
				return 'https://';
			}
			return protocol.replace('://', '') + '://';
		},

		buildEditor: function () {
			var t = this,
				prefix = t.o.prefix,
				html = '';

			t.$box = $('<div/>', {
				class: prefix + 'box ' + prefix + 'editor-visible ' + prefix + t.o.lang + ' trumbowyg'
			});

			// $ta = Textarea
			// $ed = Editor
			t.isTextarea = t.$ta.is('textarea');
			if (t.isTextarea) {
				html = t.$ta.val();
				t.$ed = $('<div/>');
				t.$box
					.insertAfter(t.$ta)
					.append(t.$ed, t.$ta);
			} else {
				t.$ed = t.$ta;
				html = t.$ed.html();

				t.$ta = $('<textarea/>', {
					name: t.$ta.attr('id'),
					height: t.height
				}).val(html);

				t.$box
					.insertAfter(t.$ed)
					.append(t.$ta, t.$ed);
				t.syncCode();
			}

			t.$ta
				.addClass(prefix + 'textarea')
				.attr('tabindex', -1)
			;

			t.$ed
				.addClass(prefix + 'editor')
				.attr({
					contenteditable: true,
					dir: t.lang._dir || 'ltr'
				})
				.html(html)
			;

			if (t.o.tabindex) {
				t.$ed.attr('tabindex', t.o.tabindex);
			}

			if (t.$c.is('[placeholder]')) {
				t.$ed.attr('placeholder', t.$c.attr('placeholder'));
			}

			if (t.$c.is('[spellcheck]')) {
				t.$ed.attr('spellcheck', t.$c.attr('spellcheck'));
			}

			if (t.o.resetCss) {
				t.$ed.addClass(prefix + 'reset-css');
			}

			if (!t.o.autogrow) {
				t.$ta.add(t.$ed).css({
					height: t.height
				});
			}

			t.semanticCode();

			if (t.o.autogrowOnEnter) {
				t.$ed.addClass(prefix + 'autogrow-on-enter');
			}

			var ctrl = false,
				composition = false,
				debounceButtonPaneStatus;

			t.$ed
				.on('dblclick', 'img', t.o.imgDblClickHandler)
				.on('keydown', function (e) {
					if ((e.ctrlKey || e.metaKey) && !e.altKey) {
						ctrl = true;
						var key = t.keys[String.fromCharCode(e.which).toUpperCase()];

						try {
							t.execCmd(key.fn, key.param);
							return false;
						} catch (c) {}
					} else {
						if (t.o.tabToIndent && e.key === 'Tab') {
							try {
								if (e.shiftKey) {
									t.execCmd('outdent', true, null);
								} else {
									t.execCmd('indent', true, null);
								}
								return false;
							} catch (c) {}
						}
					}
				})
				.on('compositionstart compositionupdate', function () {
					composition = true;
				})
				.on('keyup compositionend', function (e) {
					if (e.type === 'compositionend') {
						composition = false;
					} else if (composition) {
						return;
					}

					var keyCode = e.which;

					if (keyCode >= 37 && keyCode <= 40) {
						return;
					}

					if ((e.ctrlKey || e.metaKey) && (keyCode === 89 || keyCode === 90)) {
						t.semanticCode(false, true);
						t.$c.trigger('tbwchange');
					} else if (!ctrl && keyCode !== 17) {
						var compositionEndIE = t.isIE ? e.type === 'compositionend' : true;
						t.semanticCode(false, compositionEndIE && keyCode === 13);
						t.$c.trigger('tbwchange');
					} else if (typeof e.which === 'undefined') {
						t.semanticCode(false, false, true);
					}

					setTimeout(function () {
						ctrl = false;
					}, 50);
				})
				.on('mouseup keydown keyup', function (e) {
					if ((!e.ctrlKey && !e.metaKey) || e.altKey) {
						setTimeout(function () { // "hold on" to the ctrl key for 50ms
							ctrl = false;
						}, 50);
					}
					clearTimeout(debounceButtonPaneStatus);
					debounceButtonPaneStatus = setTimeout(function () {
						t.updateButtonPaneStatus();
					}, 50);
				})
				.on('focus blur', function (e) {
					if (e.type === 'blur') {
						t.clearButtonPaneStatus();
					}
					t.$c.trigger('tbw' + e.type);
					if (t.o.autogrowOnEnter) {
						if (t.autogrowOnEnterDontClose) {
							return;
						}
						if (e.type === 'focus') {
							t.autogrowOnEnterWasFocused = true;
							t.autogrowEditorOnEnter();
						}
						else if (!t.o.autogrow) {
							t.$ed.css({height: t.$ed.css('min-height')});
							t.$c.trigger('tbwresize');
						}
					}
				})
				.on('keyup focus', function () {
					if (!t.$ta.val().match(/<.*>/)) {
						setTimeout(function () {
							var block = t.isIE ? '<p>' : 'p';
							t.doc.execCommand('formatBlock', false, block);
							t.syncCode();
						}, 0);
					}
				})
				.on('cut drop', function () {
					setTimeout(function () {
						t.semanticCode(false, true);
						t.$c.trigger('tbwchange');
					}, 0);
				})
				.on('paste', function (e) {
					if (t.o.removeformatPasted) {
						e.preventDefault();

						if (window.getSelection && window.getSelection().deleteFromDocument) {
							window.getSelection().deleteFromDocument();
						}

						try {
							// IE
							var text = window.clipboardData.getData('Text');

							try {
								// <= IE10
								t.doc.selection.createRange().pasteHTML(text);
							} catch (c) {
								// IE 11
								t.doc.getSelection().getRangeAt(0).insertNode(t.doc.createTextNode(text));
							}
							t.$c.trigger('tbwchange', e);
						} catch (d) {
							// Not IE
							t.execCmd('insertText', (e.originalEvent || e).clipboardData.getData('text/plain'));
						}
					}

					// Call pasteHandlers
					$.each(t.pasteHandlers, function (i, pasteHandler) {
						pasteHandler(e);
					});

					setTimeout(function () {
						t.semanticCode(false, true);
						t.$c.trigger('tbwpaste', e);
						t.$c.trigger('tbwchange');
					}, 0);
				});

			t.$ta
				.on('keyup', function () {
					t.$c.trigger('tbwchange');
				})
				.on('paste', function () {
					setTimeout(function () {
						t.$c.trigger('tbwchange');
					}, 0);
				});

			$(t.doc.body).on('keydown', function (e) {
				if (e.which === 27 && $('.' + prefix + 'modal-box').length >= 1) {
					t.closeModal();
					return false;
				}
			});
		},

		//autogrow when entering logic
		autogrowEditorOnEnter: function () {
			var t = this;
			t.$ed.removeClass('autogrow-on-enter');
			var oldHeight = t.$ed[0].clientHeight;
			t.$ed.height('auto');
			var totalHeight = t.$ed[0].scrollHeight;
			t.$ed.addClass('autogrow-on-enter');
			if (oldHeight !== totalHeight) {
				t.$ed.height(oldHeight);
				setTimeout(function () {
					t.$ed.css({height: totalHeight});
					t.$c.trigger('tbwresize');
				}, 0);
			}
		},


		// Build button pane, use o.btns option
		buildBtnPane: function () {
			var t = this,
				prefix = t.o.prefix;

			var $btnPane = t.$btnPane = $('<div/>', {
				class: prefix + 'button-pane'
			});

			$.each(t.o.btns, function (i, btnGrp) {
				if (!$.isArray(btnGrp)) {
					btnGrp = [btnGrp];
				}

				var $btnGroup = $('<div/>', {
					class: prefix + 'button-group ' + ((btnGrp.indexOf('fullscreen') >= 0) ? prefix + 'right' : '')
				});
				$.each(btnGrp, function (i, btn) {
					try { // Prevent buildBtn error
						if (t.isSupportedBtn(btn)) { // It's a supported button
							$btnGroup.append(t.buildBtn(btn));
						}
					} catch (c) {
					}
				});

				if ($btnGroup.html().trim().length > 0) {
					$btnPane.append($btnGroup);
				}
			});

			t.$box.prepend($btnPane);
		},


		// Build a button and his action
		buildBtn: function (btnName) { // btnName is name of the button
			var t = this,
				prefix = t.o.prefix,
				btn = t.btnsDef[btnName],
				isDropdown = btn.dropdown,
				hasIcon = btn.hasIcon != null ? btn.hasIcon : true,
				textDef = t.lang[btnName] || btnName,

				$btn = $('<button/>', {
					type: 'button',
					class: prefix + btnName + '-button ' + (btn.class || '') + (!hasIcon ? ' ' + prefix + 'textual-button' : ''),
					html: t.hasSvg && hasIcon ?
						'<svg><use xlink:href="' + '#' + prefix + (btn.ico || btnName).replace(/([A-Z]+)/g, '-$1').toLowerCase() + '"/></svg>' :
						t.hideButtonTexts ? '' : (btn.text || btn.title || t.lang[btnName] || btnName),
					title: (btn.title || btn.text || textDef) + (btn.key ? ' (' + (t.isMac ? 'Cmd' : 'Ctrl') + ' + ' + btn.key + ')' : ''),
					tabindex: -1,
					mousedown: function () {
						if (!isDropdown || $('.' + btnName + '-' + prefix + 'dropdown', t.$box).is(':hidden')) {
							$('body', t.doc).trigger('mousedown');
						}

						if ((t.$btnPane.hasClass(prefix + 'disable') || t.$box.hasClass(prefix + 'disabled')) &&
							!$(this).hasClass(prefix + 'active') &&
							!$(this).hasClass(prefix + 'not-disable')) {
							return false;
						}

						t.execCmd((isDropdown ? 'dropdown' : false) || btn.fn || btnName, btn.param || btnName, btn.forceCss);

						return false;
					}
				});

			if (isDropdown) {
				$btn.addClass(prefix + 'open-dropdown');
				var dropdownPrefix = prefix + 'dropdown',
					dropdownOptions = { // the dropdown
						class: dropdownPrefix + '-' + btnName + ' ' + dropdownPrefix + ' ' + prefix + 'fixed-top ' + (btn.dropdownClass || '')
					};
				dropdownOptions['data-' + dropdownPrefix] = btnName;
				var $dropdown = $('<div/>', dropdownOptions);
				$.each(isDropdown, function (i, def) {
					if (t.btnsDef[def] && t.isSupportedBtn(def)) {
						$dropdown.append(t.buildSubBtn(def));
					}
				});
				t.$box.append($dropdown.hide());
			} else if (btn.key) {
				t.keys[btn.key] = {
					fn: btn.fn || btnName,
					param: btn.param || btnName
				};
			}

			if (!isDropdown) {
				t.tagToButton[(btn.tag || btnName).toLowerCase()] = btnName;
			}

			return $btn;
		},
		// Build a button for dropdown menu
		// @param n : name of the subbutton
		buildSubBtn: function (btnName) {
			var t = this,
				prefix = t.o.prefix,
				btn = t.btnsDef[btnName],
				hasIcon = btn.hasIcon != null ? btn.hasIcon : true;

			if (btn.key) {
				t.keys[btn.key] = {
					fn: btn.fn || btnName,
					param: btn.param || btnName
				};
			}

			t.tagToButton[(btn.tag || btnName).toLowerCase()] = btnName;

			return $('<button/>', {
				type: 'button',
				class: prefix + btnName + '-dropdown-button ' + (btn.class || '') + (btn.ico ? ' ' + prefix + btn.ico + '-button' : ''),
				html: t.hasSvg && hasIcon ?
				  '<svg><use xlink:href="' + '#' + prefix + (btn.ico || btnName).replace(/([A-Z]+)/g, '-$1').toLowerCase() + '"/></svg>' + (btn.text || btn.title || t.lang[btnName] || btnName) :
				  (btn.text || btn.title || t.lang[btnName] || btnName),
				title: (btn.key ? '(' + (t.isMac ? 'Cmd' : 'Ctrl') + ' + ' + btn.key + ')' : null),
				style: btn.style || null,
				mousedown: function () {
					$('body', t.doc).trigger('mousedown');

					t.execCmd(btn.fn || btnName, btn.param || btnName, btn.forceCss);

					return false;
				}
			});
		},
		// Check if button is supported
		isSupportedBtn: function (btnName) {
			try {
				return this.btnsDef[btnName].isSupported();
			} catch (e) {
			}
			return true;
		},

		// Build overlay for modal box
		buildOverlay: function () {
			var t = this;
			t.$overlay = $('<div/>', {
				class: t.o.prefix + 'overlay'
			}).appendTo(t.$box);
			return t.$overlay;
		},
		showOverlay: function () {
			var t = this;
			$(window).trigger('scroll');
			t.$overlay.fadeIn(200);
			t.$box.addClass(t.o.prefix + 'box-blur');
		},
		hideOverlay: function () {
			var t = this;
			t.$overlay.fadeOut(50);
			t.$box.removeClass(t.o.prefix + 'box-blur');
		},

		// Management of fixed button pane
		fixedBtnPaneEvents: function () {
			var t = this,
				fixedFullWidth = t.o.fixedFullWidth,
				$box = t.$box;

			if (!t.o.fixedBtnPane) {
				return;
			}

			t.isFixed = false;

			$(window)
				.on('scroll.' + t.eventNamespace + ' resize.' + t.eventNamespace, function () {
					if (!$box) {
						return;
					}

					t.syncCode();

					var scrollTop = $(window).scrollTop(),
						offset = $box.offset().top + 1,
						$buttonPane = t.$btnPane,
						buttonPaneOuterHeight = $buttonPane.outerHeight() - 2;

					if ((scrollTop - offset > 0) && ((scrollTop - offset - t.height) < 0)) {
						if (!t.isFixed) {
							t.isFixed = true;
							$buttonPane.css({
								position: 'fixed',
								top: 0,
								left: fixedFullWidth ? 0 : 'auto',
								zIndex: 7
							});
							t.$box.css({paddingTop: $buttonPane.height()});
						}
						$buttonPane.css({
							width: fixedFullWidth ? '100%' : (($box.width() - 1))
						});

						$('.' + t.o.prefix + 'fixed-top', $box).css({
							position: fixedFullWidth ? 'fixed' : 'absolute',
							top: fixedFullWidth ? buttonPaneOuterHeight : buttonPaneOuterHeight + (scrollTop - offset),
							zIndex: 15
						});
					} else if (t.isFixed) {
						t.isFixed = false;
						$buttonPane.removeAttr('style');
						t.$box.css({paddingTop: 0});
						$('.' + t.o.prefix + 'fixed-top', $box).css({
							position: 'absolute',
							top: buttonPaneOuterHeight
						});
					}
				});
		},

		// Disable editor
		setDisabled: function (disable) {
			var t = this,
				prefix = t.o.prefix;

			t.disabled = disable;

			if (disable) {
				t.$ta.attr('disabled', true);
			} else {
				t.$ta.removeAttr('disabled');
			}
			t.$box.toggleClass(prefix + 'disabled', disable);
			t.$ed.attr('contenteditable', !disable);
		},

		// Destroy the editor
		destroy: function () {
			var t = this,
				prefix = t.o.prefix;

			if (t.isTextarea) {
				t.$box.after(
					t.$ta
						.css({height: ''})
						.val(t.html())
						.removeClass(prefix + 'textarea')
						.show()
				);
			} else {
				t.$box.after(
					t.$ed
						.css({height: ''})
						.removeClass(prefix + 'editor')
						.removeAttr('contenteditable')
						.removeAttr('dir')
						.html(t.html())
						.show()
				);
			}

			t.$ed.off('dblclick', 'img');

			t.destroyPlugins();

			t.$box.remove();
			t.$c.removeData('trumbowyg');
			$('body').removeClass(prefix + 'body-fullscreen');
			t.$c.trigger('tbwclose');
			$(window).off('scroll.' + t.eventNamespace + ' resize.' + t.eventNamespace);
		},


		// Empty the editor
		empty: function () {
			this.$ta.val('');
			this.syncCode(true);
		},


		// Function call when click on viewHTML button
		toggle: function () {
			var t = this,
				prefix = t.o.prefix;

			if (t.o.autogrowOnEnter) {
				t.autogrowOnEnterDontClose = !t.$box.hasClass(prefix + 'editor-hidden');
			}

			t.semanticCode(false, true);
			t.$c.trigger('tbwchange');

			setTimeout(function () {
				t.doc.activeElement.blur();
				t.$box.toggleClass(prefix + 'editor-hidden ' + prefix + 'editor-visible');
				t.$btnPane.toggleClass(prefix + 'disable');
				$('.' + prefix + 'viewHTML-button', t.$btnPane).toggleClass(prefix + 'active');
				if (t.$box.hasClass(prefix + 'editor-visible')) {
					t.$ta.attr('tabindex', -1);
				} else {
					t.$ta.removeAttr('tabindex');
				}

				if (t.o.autogrowOnEnter && !t.autogrowOnEnterDontClose) {
					t.autogrowEditorOnEnter();
				}
			}, 0);
		},

		// Open dropdown when click on a button which open that
		dropdown: function (name) {
			var t = this,
				$body = $('body', t.doc),
				prefix = t.o.prefix,
				$dropdown = $('[data-' + prefix + 'dropdown=' + name + ']', t.$box),
				$btn = $('.' + prefix + name + '-button', t.$btnPane),
				show = $dropdown.is(':hidden');

			$body.trigger('mousedown');

			if (show) {
				var btnOffsetLeft = $btn.offset().left;
				$btn.addClass(prefix + 'active');

				$dropdown.css({
					position: 'absolute',
					top: $btn.offset().top - t.$btnPane.offset().top + $btn.outerHeight(),
					left: (t.o.fixedFullWidth && t.isFixed) ? btnOffsetLeft : (btnOffsetLeft - t.$btnPane.offset().left)
				}).show();

				$(window).trigger('scroll');

				$body.on('mousedown.' + t.eventNamespace, function (e) {
					if (!$dropdown.is(e.target)) {
						$('.' + prefix + 'dropdown', t.$box).hide();
						$('.' + prefix + 'active', t.$btnPane).removeClass(prefix + 'active');
						$body.off('mousedown.' + t.eventNamespace);
					}
				});
			}
		},


		// HTML Code management
		html: function (html) {
			var t = this;

			if (html != null) {
				t.$ta.val(html);
				t.syncCode(true);
				t.$c.trigger('tbwchange');
				return t;
			}

			return t.$ta.val();
		},
		syncTextarea: function () {
			var t = this;
			t.$ta.val(t.$ed.text().trim().length > 0 || t.$ed.find(t.o.tagsToKeep.join(',')).length > 0 ? t.$ed.html() : '');
		},
		syncCode: function (force) {
			var t = this;
			if (!force && t.$ed.is(':visible')) {
				t.syncTextarea();
			} else {
				// wrap the content in a div it's easier to get the inner html
				var html = $('<div>').html(t.$ta.val());
				// scrub the html before loading into the doc
				var safe = $('<div>').append(html);
				$(t.o.tagsToRemove.join(','), safe).remove();
				t.$ed.html(safe.contents().html());
			}

			if (t.o.autogrow) {
				t.height = t.$ed.height();
				if (t.height !== t.$ta.css('height')) {
					t.$ta.css({height: t.height});
					t.$c.trigger('tbwresize');
				}
			}
			if (t.o.autogrowOnEnter) {
				t.$ed.height('auto');
				var totalHeight = t.autogrowOnEnterWasFocused ? t.$ed[0].scrollHeight : t.$ed.css('min-height');
				if (totalHeight !== t.$ta.css('height')) {
					t.$ed.css({height: totalHeight});
					t.$c.trigger('tbwresize');
				}
			}
		},

		// Analyse and update to semantic code
		// @param force : force to sync code from textarea
		// @param full  : wrap text nodes in <p>
		// @param keepRange  : leave selection range as it is
		semanticCode: function (force, full, keepRange) {
			var t = this;
			t.saveRange();
			t.syncCode(force);

			if (t.o.semantic) {
				t.semanticTag('b', t.o.semanticKeepAttributes);
				t.semanticTag('i', t.o.semanticKeepAttributes);
				//-- fix by unixman
			//	t.semanticTag('s', t.o.semanticKeepAttributes);
				t.semanticTag('del', t.o.semanticKeepAttributes);
				//-- #fix
				t.semanticTag('strike', t.o.semanticKeepAttributes);

				if (full) {
					var inlineElementsSelector = t.o.inlineElementsSelector,
						blockElementsSelector = ':not(' + inlineElementsSelector + ')';

					// Wrap text nodes in span for easier processing
					t.$ed.contents().filter(function () {
						return this.nodeType === 3 && this.nodeValue.trim().length > 0;
					}).wrap('<span data-tbw/>');

					// Wrap groups of inline elements in paragraphs (recursive)
					var wrapInlinesInParagraphsFrom = function ($from) {
						if ($from.length !== 0) {
							var $finalParagraph = $from.nextUntil(blockElementsSelector).addBack().wrapAll('<p/>').parent(),
								$nextElement = $finalParagraph.nextAll(inlineElementsSelector).first();
							$finalParagraph.next('br').remove();
							wrapInlinesInParagraphsFrom($nextElement);
						}
					};
					wrapInlinesInParagraphsFrom(t.$ed.children(inlineElementsSelector).first());

					t.semanticTag('div', true);

					// Get rid of temporary span's
					$('[data-tbw]', t.$ed).contents().unwrap();

					// Remove empty <p>
					t.$ed.find('p:empty').remove();
				}

				if (!keepRange) {
					t.restoreRange();
				}

				t.syncTextarea();
			}
		},

		semanticTag: function (oldTag, copyAttributes) {
			var newTag;

			if (this.o.semantic != null && typeof this.o.semantic === 'object' && this.o.semantic.hasOwnProperty(oldTag)) {
				newTag = this.o.semantic[oldTag];
			} else if (this.o.semantic === true && this.DEFAULT_SEMANTIC_MAP.hasOwnProperty(oldTag)) {
				newTag = this.DEFAULT_SEMANTIC_MAP[oldTag];
			} else {
				return;
			}

			$(oldTag, this.$ed).each(function () {
				var $oldTag = $(this);
				if($oldTag.contents().length === 0) {
					return false;
				}

				$oldTag.wrap('<' + newTag + '/>');
				if (copyAttributes) {
					$.each($oldTag.prop('attributes'), function () {
						$oldTag.parent().attr(this.name, this.value);
					});
				}
				$oldTag.contents().unwrap();
			});
		},

		// Function call when user click on "Insert Link"
		createLink: function () {
			var t = this,
				documentSelection = t.doc.getSelection(),
				selectedRange = documentSelection.getRangeAt(0),
				node = documentSelection.focusNode,
				text = new XMLSerializer().serializeToString(selectedRange.cloneContents()) || selectedRange + '',
				url,
				title,
				target;

			while (['A', 'DIV'].indexOf(node.nodeName) < 0) {
				node = node.parentNode;
			}

			if (node && node.nodeName === 'A') {
				var $a = $(node);
				text = $a.text();
				url = $a.attr('href');
				if (!t.o.minimalLinks) {
					title = $a.attr('title');
					target = $a.attr('target') || t.o.defaultLinkTarget;
				}
				var range = t.doc.createRange();
				range.selectNode(node);
				documentSelection.removeAllRanges();
				documentSelection.addRange(range);
			}

			t.saveRange();

			var options = {
				url: {
					label: 'URL',
					required: true,
					value: url
				},
				text: {
					label: t.lang.text,
					value: text
				}
			};
			if (!t.o.minimalLinks) {
				$.extend(options, {
					title: {
						label: t.lang.title,
						value: title
					},
					target: {
						label: t.lang.target,
						value: target
					}
				});
			}

			t.openModalInsert(t.lang.createLink, options, function (v) { // v is value
				var url = t.prependUrlPrefix(v.url);
				if (!url.length) {
					return false;
				}

				var link = $(['<a href="', url, '">', v.text || v.url, '</a>'].join(''));

				if (v.title) {
					link.attr('title', v.title);
				}
				if (v.target || t.o.defaultLinkTarget) {
					link.attr('target', v.target || t.o.defaultLinkTarget);
				}
				t.range.deleteContents();
				t.range.insertNode(link[0]);
				t.syncCode();
				t.$c.trigger('tbwchange');
				return true;
			});
		},
		prependUrlPrefix: function (url) {
			var t = this;
			if (!t.urlPrefix) {
				return url;
			}

			var VALID_LINK_PREFIX = /^([a-z][-+.a-z0-9]*:|\/|#)/i;
			if (VALID_LINK_PREFIX.test(url)) {
				return url;
			}

			var SIMPLE_EMAIL_REGEX = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
			if (SIMPLE_EMAIL_REGEX.test(url)) {
				return 'mailto:' + url;
			}

			return t.urlPrefix + url;
		},
		unlink: function () {
			var t = this,
				documentSelection = t.doc.getSelection(),
				node = documentSelection.focusNode;

			if (documentSelection.isCollapsed) {
				while (['A', 'DIV'].indexOf(node.nodeName) < 0) {
					node = node.parentNode;
				}

				if (node && node.nodeName === 'A') {
					var range = t.doc.createRange();
					range.selectNode(node);
					documentSelection.removeAllRanges();
					documentSelection.addRange(range);
				}
			}
			t.execCmd('unlink', undefined, undefined, true);
		},
		insertImage: function () {
			var t = this;
			t.saveRange();

			var options = {
				url: {
					label: 'URL',
					required: true
				},
				alt: {
					label: t.lang.description,
					value: t.getRangeText()
				}
			};

			if (t.o.imageWidthModalEdit) {
				options.width = {};
			}

			t.openModalInsert(t.lang.insertImage, options, function (v) { // v are values
				t.execCmd('insertImage', v.url, false, true);
				var $img = $('img[src="' + v.url + '"]:not([alt])', t.$box);
				$img.attr('alt', v.alt);
				$img.attr('style', 'max-width:99%!important;'); // fix by unixman

				if (t.o.imageWidthModalEdit) {
					$img.attr({
						width: v.width
					});
				}

				t.syncCode();
				t.$c.trigger('tbwchange');

				return true;
			});
		},
		fullscreen: function () {
			var t = this,
				prefix = t.o.prefix,
				fullscreenCssClass = prefix + 'fullscreen',
				fullscreenPlaceholderClass = fullscreenCssClass + '-placeholder',
				isFullscreen,
				editorHeight = t.$box.outerHeight();

			t.$box.toggleClass(fullscreenCssClass);
			isFullscreen = t.$box.hasClass(fullscreenCssClass);

			if (isFullscreen) {
				t.$box.before(
					$('<div/>', {
						class: fullscreenPlaceholderClass
					}).css({
						height: editorHeight
					})
				);
			} else {
				$('.' + fullscreenPlaceholderClass).remove();
			}

			$('body').toggleClass(prefix + 'body-fullscreen', isFullscreen);
			$(window).trigger('scroll');
			t.$c.trigger('tbw' + (isFullscreen ? 'open' : 'close') + 'fullscreen');
		},


		/*
		 * Call method of trumbowyg if exist
		 * else try to call anonymous function
		 * and finally native execCommand
		 */
		execCmd: function (cmd, param, forceCss, skipTrumbowyg) {
			var t = this;
			skipTrumbowyg = !!skipTrumbowyg || '';

			if (cmd !== 'dropdown') {
				t.$ed.focus();
			}

			try {
				t.doc.execCommand('styleWithCSS', false, forceCss || false);
			} catch (c) {
			}

			try {
				t[cmd + skipTrumbowyg](param);
			} catch (c) {
				try {
					cmd(param);
				} catch (e2) {
					if (cmd === 'insertHorizontalRule') {
						param = undefined;
					} else if (cmd === 'formatBlock' && t.isIE) {
						param = '<' + param + '>';
					}

					t.doc.execCommand(cmd, false, param);

					t.syncCode();
					t.semanticCode(false, true);
				}

				if (cmd !== 'dropdown') {
					t.updateButtonPaneStatus();
					t.$c.trigger('tbwchange');
				}
			}
		},


		// Open a modal box
		openModal: function (title, content, buildForm) {
			var t = this,
				prefix = t.o.prefix;

			buildForm = buildForm !== false;

			// No open a modal box when exist other modal box
			if ($('.' + prefix + 'modal-box', t.$box).length > 0) {
				return false;
			}
			if (t.o.autogrowOnEnter) {
				t.autogrowOnEnterDontClose = true;
			}

			t.saveRange();
			t.showOverlay();

			// Disable all btnPane btns
			t.$btnPane.addClass(prefix + 'disable');

			// Build out of ModalBox, it's the mask for animations
			var $modal = $('<div/>', {
				class: prefix + 'modal ' + prefix + 'fixed-top'
			}).css({
				top: t.$box.offset().top + t.$btnPane.height(),
				zIndex: 99999
			}).appendTo($(t.doc.body));

			// Click on overlay close modal by cancelling them
			t.$overlay.one('click', function () {
				$modal.trigger(CANCEL_EVENT);
				return false;
			});

			// Build the form
			var formOrContent;
			if (buildForm) {
				formOrContent = $('<form/>', {
					action: '',
					html: content
				})
				  .on('submit', function () {
					  $modal.trigger(CONFIRM_EVENT);
					  return false;
				  })
				  .on('reset', function () {
					  $modal.trigger(CANCEL_EVENT);
					  return false;
				  })
				  .on('submit reset', function () {
					  if (t.o.autogrowOnEnter) {
						  t.autogrowOnEnterDontClose = false;
					  }
				  });
			} else {
				formOrContent = content;
			}


			// Build ModalBox and animate to show them
			var $box = $('<div/>', {
				class: prefix + 'modal-box',
				html: formOrContent
			})
				.css({
					top: '-' + t.$btnPane.outerHeight(),
					opacity: 0,
					paddingBottom: buildForm ? null : '5%',
				})
				.appendTo($modal)
				.animate({
					top: 0,
					opacity: 1
				}, 100);


			// Append title
			if (title) {
				$('<span/>', {
					text: title,
					class: prefix + 'modal-title'
				}).prependTo($box);
			}

			if (buildForm) {
				// Focus in modal box
				$('input:first', $box).focus();

				// Append Confirm and Cancel buttons
				t.buildModalBtn('submit', $box);
				t.buildModalBtn('reset', $box);

				$modal.height($box.outerHeight() + 10);
			}

			$(window).trigger('scroll');
			t.$c.trigger('tbwmodalopen');

			return $modal;
		},
		// @param n is name of modal
		buildModalBtn: function (n, $modal) {
			var t = this,
				prefix = t.o.prefix;

			return $('<button/>', {
				class: prefix + 'modal-button ' + prefix + 'modal-' + n,
				type: n,
				text: t.lang[n] || n
			}).appendTo($('form', $modal));
		},
		// close current modal box
		closeModal: function () {
			var t = this,
				prefix = t.o.prefix;

			t.$btnPane.removeClass(prefix + 'disable');
			t.$overlay.off();

			// Find the modal box
			var $modalBox = $('.' + prefix + 'modal-box', $(t.doc.body));

			$modalBox.animate({
				top: '-' + $modalBox.height()
			}, 100, function () {
				$modalBox.parent().remove();
				t.hideOverlay();
				t.$c.trigger('tbwmodalclose');
			});

			t.restoreRange();
		},
		// Pre-formatted build and management modal
		openModalInsert: function (title, fields, cmd) {
			var t = this,
				prefix = t.o.prefix,
				lg = t.lang,
				html = '';

			$.each(fields, function (fieldName, field) {
				var l = field.label || fieldName,
					n = field.name || fieldName,
					a = field.attributes || {};

				var attr = Object.keys(a).map(function (prop) {
					return prop + '="' + a[prop] + '"';
				}).join(' ');

				html += '<label><input type="' + (field.type || 'text') + '" name="' + n + '"' +
					(field.type === 'checkbox' && field.value ? ' checked="checked"' : ' value="' + (field.value || '').replace(/"/g, '&quot;')) +
					'"' + attr + '><span class="' + prefix + 'input-infos"><span>' +
					(lg[l] ? lg[l] : l) +
					'</span></span></label>';
			});

			return t.openModal(title, html)
				.on(CONFIRM_EVENT, function () {
					var $form = $('form', $(this)),
						valid = true,
						values = {};

					$.each(fields, function (fieldName, field) {
						var n = field.name || fieldName;

						var $field = $('input[name="' + n + '"]', $form),
							inputType = $field.attr('type');

						switch (inputType.toLowerCase()) {
							case 'checkbox':
								values[n] = $field.is(':checked');
								break;
							case 'radio':
								values[n] = $field.filter(':checked').val();
								break;
							default:
								values[n] = $.trim($field.val());
								break;
						}
						// Validate value
						if (field.required && values[n] === '') {
							valid = false;
							t.addErrorOnModalField($field, t.lang.required);
						} else if (field.pattern && !field.pattern.test(values[n])) {
							valid = false;
							t.addErrorOnModalField($field, field.patternError);
						}
					});

					if (valid) {
						t.restoreRange();

						if (cmd(values, fields)) {
							t.syncCode();
							t.$c.trigger('tbwchange');
							t.closeModal();
							$(this).off(CONFIRM_EVENT);
						}
					}
				})
				.one(CANCEL_EVENT, function () {
					$(this).off(CONFIRM_EVENT);
					t.closeModal();
				});
		},
		addErrorOnModalField: function ($field, err) {
			var prefix = this.o.prefix,
				spanErrorClass = prefix + 'msg-error',
				$label = $field.parent();

			$field
				.on('change keyup', function () {
					$label.removeClass(prefix + 'input-error');
					setTimeout(function () {
						$label.find('.' + spanErrorClass).remove();
					}, 150);
				});

			$label
				.addClass(prefix + 'input-error')
				.find('input+span')
				.append(
					$('<span/>', {
						class: spanErrorClass,
						text: err
					})
				);
		},

		getDefaultImgDblClickHandler: function () {
			var t = this;

			return function () {
				var $img = $(this),
					src = $img.attr('src'),
					base64 = '(Base64)';

				if (src.indexOf('data:image') === 0) {
					src = base64;
				}

				var options = {
					url: {
						label: 'URL',
						value: src,
						required: true
					},
					alt: {
						label: t.lang.description,
						value: $img.attr('alt')
					}
				};

				if (t.o.imageWidthModalEdit) {
					options.width = {
						value: $img.attr('width') ? $img.attr('width') : ''
					};
				}

				t.openModalInsert(t.lang.insertImage, options, function (v) {
					if (v.url !== base64) {
						$img.attr({
							src: v.url
						});
					}
					$img.attr({
						alt: v.alt
					});

					if (t.o.imageWidthModalEdit) {
						if (parseInt(v.width) > 0) {
							$img.attr({
								width: v.width
							});
						} else {
							$img.removeAttr('width');
						}
					}

					return true;
				});
				return false;
			};
		},

		// Range management
		saveRange: function () {
			var t = this,
				documentSelection = t.doc.getSelection();

			t.range = null;

			if (!documentSelection || !documentSelection.rangeCount) {
				return;
			}

			var savedRange = t.range = documentSelection.getRangeAt(0),
				range = t.doc.createRange(),
				rangeStart;
			range.selectNodeContents(t.$ed[0]);
			range.setEnd(savedRange.startContainer, savedRange.startOffset);
			rangeStart = (range + '').length;
			t.metaRange = {
				start: rangeStart,
				end: rangeStart + (savedRange + '').length
			};
		},
		restoreRange: function () {
			var t = this,
				metaRange = t.metaRange,
				savedRange = t.range,
				documentSelection = t.doc.getSelection(),
				range;

			if (!savedRange) {
				return;
			}

			if (metaRange && metaRange.start !== metaRange.end) { // Algorithm from http://jsfiddle.net/WeWy7/3/
				var charIndex = 0,
					nodeStack = [t.$ed[0]],
					node,
					foundStart = false,
					stop = false;

				range = t.doc.createRange();

				while (!stop && (node = nodeStack.pop())) {
					if (node.nodeType === 3) {
						var nextCharIndex = charIndex + node.length;
						if (!foundStart && metaRange.start >= charIndex && metaRange.start <= nextCharIndex) {
							range.setStart(node, metaRange.start - charIndex);
							foundStart = true;
						}
						if (foundStart && metaRange.end >= charIndex && metaRange.end <= nextCharIndex) {
							range.setEnd(node, metaRange.end - charIndex);
							stop = true;
						}
						charIndex = nextCharIndex;
					} else {
						var cn = node.childNodes,
							i = cn.length;

						while (i > 0) {
							i -= 1;
							nodeStack.push(cn[i]);
						}
					}
				}
			}

			// Fix IE11 Error 'Could not complete the operation due to error 800a025e'.
			// https://stackoverflow.com/questions/16160996/could-not-complete-the-operation-due-to-error-800a025e
			try {
				documentSelection.removeAllRanges();
			} catch (e) {
			}

			documentSelection.addRange(range || savedRange);
		},
		getRangeText: function () {
			return this.range + '';
		},

		clearButtonPaneStatus: function () {
			var t = this,
			  prefix = t.o.prefix,
			  activeClasses = prefix + 'active-button ' + prefix + 'active',
			  originalIconClass = prefix + 'original-icon';

			// Reset all buttons and dropdown state
			$('.' + prefix + 'active-button', t.$btnPane).removeClass(activeClasses);
			$('.' + originalIconClass, t.$btnPane).each(function () {
				$(this).find('svg use').attr('xlink:href', $(this).data(originalIconClass));
			});
		},
		updateButtonPaneStatus: function () {
			var t = this,
				prefix = t.o.prefix,
				activeClasses = prefix + 'active-button ' + prefix + 'active',
				originalIconClass = prefix + 'original-icon',
				tags = t.getTagsRecursive(t.doc.getSelection().focusNode);

			t.clearButtonPaneStatus();

			$.each(tags, function (i, tag) {
				var btnName = t.tagToButton[tag.toLowerCase()],
					$btn = $('.' + prefix + btnName + '-button', t.$btnPane);

				if ($btn.length > 0) {
					$btn.addClass(activeClasses);
				} else {
					try {
						$btn = $('.' + prefix + 'dropdown .' + prefix + btnName + '-dropdown-button', t.$box);
						var $btnSvgUse = $btn.find('svg use'),
							dropdownBtnName = $btn.parent().data(prefix + 'dropdown'),
							$dropdownBtn = $('.' + prefix + dropdownBtnName + '-button', t.$box),
							$dropdownBtnSvgUse = $dropdownBtn.find('svg use');

						// Highlight the dropdown button
						$dropdownBtn.addClass(activeClasses);

						// Switch dropdown icon to the active sub-icon one
						if (t.o.changeActiveDropdownIcon && $btnSvgUse.length > 0) {
							// Save original icon
							$dropdownBtn
							  .addClass(originalIconClass)
							  .data(originalIconClass, $dropdownBtnSvgUse.attr('xlink:href'));

							// Put the active sub-button's icon
							$dropdownBtnSvgUse
							  .attr('xlink:href', $btnSvgUse.attr('xlink:href'));
						}
					} catch (e) {
					}
				}
			});
		},
		getTagsRecursive: function (element, tags) {
			var t = this;
			tags = tags || (element && element.tagName ? [element.tagName] : []);

			if (element && element.parentNode) {
				element = element.parentNode;
			} else {
				return tags;
			}

			var tag = element.tagName;
			if (tag === 'DIV') {
				return tags;
			}
			if (tag === 'P' && element.style.textAlign !== '') {
				tags.push(element.style.textAlign);
			}

			$.each(t.tagHandlers, function (i, tagHandler) {
				tags = tags.concat(tagHandler(element, t));
			});

			tags.push(tag);

			return t.getTagsRecursive(element, tags).filter(function (tag) {
				return tag != null;
			});
		},

		// Plugins
		initPlugins: function () {
			var t = this;
			t.loadedPlugins = [];
			$.each($.trumbowyg.plugins, function (name, plugin) {
				if (!plugin.shouldInit || plugin.shouldInit(t)) {
					plugin.init(t);
					if (plugin.tagHandler) {
						t.tagHandlers.push(plugin.tagHandler);
					}
					t.loadedPlugins.push(plugin);
				}
			});
		},
		destroyPlugins: function () {
			var t = this;
			$.each(this.loadedPlugins, function (i, plugin) {
				if (plugin.destroy) {
					plugin.destroy(t);
				}
			});
		}
	};
})(navigator, window, document, jQuery);


//===============================================================


/**
 * trumbowyg.history.js v1.0
 * Trumbowyg History Plugin
 * @author Sven Dunemann [dunemann@forelabs.eu]
 * @license MIT
 */

(function ($) {
	'use strict';
	$.extend(true, $.trumbowyg, {
		langs: {
			en: {
				history: {
					redo: 'Redo',
					undo: 'Undo'
				}
			}
		},
		plugins: {
			history: {
				init: function (t) {
					t.o.plugins.history = $.extend(true, {
						_stack: [],
						_index: -1,
						_focusEl: undefined
					}, t.o.plugins.history || {});

					var btnBuildDefRedo = {
						title: t.lang.history.redo,
						ico: 'redo',
						key: 'Y',
						fn: function () {
							if (t.o.plugins.history._index < t.o.plugins.history._stack.length - 1) {
								t.o.plugins.history._index += 1;
								var index = t.o.plugins.history._index;
								var newState = t.o.plugins.history._stack[index];

								t.execCmd('html', newState);
								// because of some semantic optimisations we have to save the state back
								// to history
								t.o.plugins.history._stack[index] = t.$ed.html();

								carretToEnd();
								toggleButtonStates();
							}
						}
					};

					var btnBuildDefUndo = {
						title: t.lang.history.undo,
						ico: 'undo',
						key: 'Z',
						fn: function () {
							if (t.o.plugins.history._index > 0) {
								t.o.plugins.history._index -= 1;
								var index = t.o.plugins.history._index,
									newState = t.o.plugins.history._stack[index];

								t.execCmd('html', newState);
								// because of some semantic optimisations we have to save the state back
								// to history
								t.o.plugins.history._stack[index] = t.$ed.html();

								carretToEnd();
								toggleButtonStates();
							}
						}
					};

					var pushToHistory = function () {
						var index = t.o.plugins.history._index,
							stack = t.o.plugins.history._stack,
							latestState = stack.slice(-1)[0] || '<p></p>',
							prevState = stack[index],
							newState = t.$ed.html(),
							focusEl = t.doc.getSelection().focusNode,
							focusElText = '',
							latestStateTagsList,
							newStateTagsList,
							prevFocusEl = t.o.plugins.history._focusEl;

						latestStateTagsList = $('<div>' + latestState + '</div>').find('*').map(function () {
							return this.localName;
						});
						newStateTagsList = $('<div>' + newState + '</div>').find('*').map(function () {
							return this.localName;
						});
						if (focusEl) {
							t.o.plugins.history._focusEl = focusEl;
							focusElText = focusEl.outerHTML || focusEl.textContent;
						}

						if (newState !== prevState) {
							// a new stack entry is defined when current insert ends on a whitespace character
							// or count of node elements has been changed
							// or focused element differs from previous one
							if (focusElText.slice(-1).match(/\s/) ||
								!arraysAreIdentical(latestStateTagsList, newStateTagsList) ||
								t.o.plugins.history._index <= 0 || focusEl !== prevFocusEl)
							{
								t.o.plugins.history._index += 1;
								// remove newer entries in history when something new was added
								// because timeline was changes with interaction
								t.o.plugins.history._stack = stack.slice(
									0, t.o.plugins.history._index
								);
								// now add new state to modified history
								t.o.plugins.history._stack.push(newState);
							} else {
								// modify last stack entry
								t.o.plugins.history._stack[index] = newState;
							}

							toggleButtonStates();
						}
					};

					var toggleButtonStates = function () {
						var index = t.o.plugins.history._index,
							stackSize = t.o.plugins.history._stack.length,
							undoState = (index > 0),
							redoState = (stackSize !== 0 && index !== stackSize - 1);

						toggleButtonState('historyUndo', undoState);
						toggleButtonState('historyRedo', redoState);
					};

					var toggleButtonState = function (btn, enable) {
						var button = t.$box.find('.trumbowyg-' + btn + '-button');

						if (enable) {
							button.removeClass('trumbowyg-disable');
						} else if (!button.hasClass('trumbowyg-disable')) {
							button.addClass('trumbowyg-disable');
						}
					};

					var arraysAreIdentical = function (a, b) {
						if (a === b) {
							return true;
						}
						if (a == null || b == null) {
							return false;
						}
						if (a.length !== b.length) {
							return false;
						}

						for (var i = 0; i < a.length; i += 1) {
							if (a[i] !== b[i]) {
								return false;
							}
						}
						return true;
					};

					var carretToEnd = function () {
						var node = t.doc.getSelection().focusNode,
							range = t.doc.createRange();

						if (node.childNodes.length > 0) {
							range.setStartAfter(node.childNodes[node.childNodes.length - 1]);
							range.setEndAfter(node.childNodes[node.childNodes.length - 1]);
							t.doc.getSelection().removeAllRanges();
							t.doc.getSelection().addRange(range);
						}
					};

					t.$c.on('tbwinit tbwchange', pushToHistory);

					t.addBtnDef('historyRedo', btnBuildDefRedo);
					t.addBtnDef('historyUndo', btnBuildDefUndo);
				}
			}
		}
	});
})(jQuery);


//===============================================================


/**
 * trumbowyg.fontfamily.js v2.20.0
 * Trumbowyg Font Family Plugin
 */

(function ($) {
	'use strict';

	$.extend(true, $.trumbowyg, {
		langs: {
			en: {
				fontFamily: 'Font'
			}
		}
	});

	var defaultOptions = {
		fontList: [
			{name: 'Sans Serif', family: 'sans-serif'},
			{name: 'Serif', family: 'serif'},
			{name: 'Mono Space', family: 'monospace'},
		]
	};

	// Add dropdown with web safe fonts
	$.extend(true, $.trumbowyg, {
		plugins: {
			fontfamily: {
				init: function (trumbowyg) {
					trumbowyg.o.plugins.fontfamily = $.extend({},
					  defaultOptions,
					  trumbowyg.o.plugins.fontfamily || {}
					);

					trumbowyg.addBtnDef('fontfamily', {
						dropdown: buildDropdown(trumbowyg),
						hasIcon: false,
						text: trumbowyg.lang.fontFamily
					});
				}
			}
		}
	});

	function buildDropdown(trumbowyg) {
		var dropdown = [];

		$.each(trumbowyg.o.plugins.fontfamily.fontList, function (index, font) {
			trumbowyg.addBtnDef('fontfamily_' + index, {
				title: '<span style="font-family: ' + font.family + ';">' + font.name + '</span>',
				hasIcon: false,
				fn: function () {
					trumbowyg.execCmd('fontName', font.family, true);
				}
			});
			dropdown.push('fontfamily_' + index);
		});

		return dropdown;
	}
})(jQuery);


//===============================================================


/**
 * trumbowyg.colors.js v2.20.0
 * Trumbowyg Text Colors Plugin
 */

(function ($) {
	'use strict';

	$.extend(true, $.trumbowyg, {
		langs: {
			en: {
				foreColor: 'Text color',
				backColor: 'Background color',
				foreColorRemove: 'Remove text color',
				backColorRemove: 'Remove background color'
			}
		}
	});

	function hex(x) {
		return ('0' + parseInt(x).toString(16)).slice(-2);
	}

	function colorToHex(rgb) {
		if (rgb.search('rgb') === -1) {
			return rgb.replace('#', '');
		} else if (rgb === 'rgba(0, 0, 0, 0)') {
			return 'transparent';
		} else {
			rgb = rgb.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/);
			return hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);
		}
	}

	function colorTagHandler(element, trumbowyg) {
		var tags = [];

		if (!element.style) {
			return tags;
		}

		// background color
		if (element.style.backgroundColor !== '') {
			var backColor = colorToHex(element.style.backgroundColor);
			if (trumbowyg.o.plugins.colors.colorList.indexOf(backColor) >= 0) {
				tags.push('backColor' + backColor);
			} else {
				tags.push('backColorFree');
			}
		}

		// text color
		var foreColor;
		if (element.style.color !== '') {
			foreColor = colorToHex(element.style.color);
		} else if (element.hasAttribute('color')) {
			foreColor = colorToHex(element.getAttribute('color'));
		}
		if (foreColor) {
			if (trumbowyg.o.plugins.colors.colorList.indexOf(foreColor) >= 0) {
				tags.push('foreColor' + foreColor);
			} else {
				tags.push('foreColorFree');
			}
		}

		return tags;
	}

	var defaultOptions = {
		colorList: [
			'ffffff', '000000', 'eeece1', '1f497d', '4f81bd', 'c0504d', '9bbb59', '8064a2', '4bacc6', 'f79646', 'ffff00',
			'f2f2f2', '7f7f7f', 'ddd9c3', 'c6d9f0', 'dbe5f1', 'f2dcdb', 'ebf1dd', 'e5e0ec', 'dbeef3', 'fdeada', 'fff2ca',
			'd8d8d8', '595959', 'c4bd97', '8db3e2', 'b8cce4', 'e5b9b7', 'd7e3bc', 'ccc1d9', 'b7dde8', 'fbd5b5', 'ffe694',
			'bfbfbf', '3f3f3f', '938953', '548dd4', '95b3d7', 'd99694', 'c3d69b', 'b2a2c7', 'b7dde8', 'fac08f', 'f2c314',
			'a5a5a5', '262626', '494429', '17365d', '366092', '953734', '76923c', '5f497a', '92cddc', 'e36c09', 'c09100',
			'7f7f7f', '0c0c0c', '1d1b10', '0f243e', '244061', '632423', '4f6128', '3f3151', '31859b', '974806', '7f6000'
		],
		foreColorList: null, // fallbacks on colorList
		backColorList: null, // fallbacks on colorList
		allowCustomForeColor: true,
		allowCustomBackColor: true,
		displayAsList: false,
	};

	// Add all colors in two dropdowns
	$.extend(true, $.trumbowyg, {
		plugins: {
			color: {
				init: function (trumbowyg) {
					trumbowyg.o.plugins.colors = trumbowyg.o.plugins.colors || defaultOptions;
					var dropdownClass = trumbowyg.o.plugins.colors.displayAsList ? trumbowyg.o.prefix + 'dropdown--color-list' : '';

					var foreColorBtnDef = {
						dropdown: buildDropdown('foreColor', trumbowyg),
						dropdownClass: dropdownClass,
					},
					backColorBtnDef = {
						dropdown: buildDropdown('backColor', trumbowyg),
						dropdownClass: dropdownClass,
					};

					trumbowyg.addBtnDef('foreColor', foreColorBtnDef);
					trumbowyg.addBtnDef('backColor', backColorBtnDef);
				},
				tagHandler: colorTagHandler
			}
		}
	});

	function buildDropdown(fn, trumbowyg) {
		var dropdown = [],
			trumbowygColorOptions = trumbowyg.o.plugins.colors,
			colorList = trumbowygColorOptions[fn + 'List'] || trumbowygColorOptions.colorList;

		$.each(colorList, function (i, color) {
			var btn = fn + color,
				btnDef = {
					fn: fn,
					forceCss: true,
					hasIcon: false,
					text: trumbowyg.lang['#' + color] || ('#' + color),
					param: '#' + color,
					style: 'background-color: #' + color + ';'
				};

			if (trumbowygColorOptions.displayAsList && fn === 'foreColor') {
				btnDef.style = 'color: #' + color + ' !important;';
			}

			trumbowyg.addBtnDef(btn, btnDef);
			dropdown.push(btn);
		});

		// Remove color
		var removeColorButtonName = fn + 'Remove',
			removeColorBtnDef = {
				fn: 'removeFormat',
				hasIcon: false,
				param: fn,
				style: 'background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAG0lEQVQIW2NkQAAfEJMRmwBYhoGBYQtMBYoAADziAp0jtJTgAAAAAElFTkSuQmCC);'
			};

		if (trumbowygColorOptions.displayAsList) {
			removeColorBtnDef.style = '';
		}

		trumbowyg.addBtnDef(removeColorButtonName, removeColorBtnDef);
		dropdown.push(removeColorButtonName);

		// Custom color
		if (trumbowygColorOptions['allowCustom' + fn.charAt(0).toUpperCase() + fn.substr(1)]) {
			// add free color btn
			var freeColorButtonName = fn + 'Free',
				freeColorBtnDef = {
					fn: function () {
						trumbowyg.openModalInsert(trumbowyg.lang[fn],
							{
								color: {
									label: fn,
									forceCss: true,
									type: 'color',
									value: '#FFFFFF'
								}
							},
							// callback
							function (values) {
								trumbowyg.execCmd(fn, values.color);
								return true;
							}
						);
					},
					hasIcon: false,
					text: '#',
					// style adjust for displaying the text
					style: 'text-indent: 0; line-height: 20px; padding: 0 5px;'
				};

			trumbowyg.addBtnDef(freeColorButtonName, freeColorBtnDef);
			dropdown.push(freeColorButtonName);
		}

		return dropdown;
	}
})(jQuery);


// #END

